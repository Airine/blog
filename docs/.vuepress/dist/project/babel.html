<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>了解babel的使用和原理</title>
    <meta name="description" content="">
    <link rel="alternate" type="application/rss+xml" href="https://www.banli17.com/rss.xml" title=" RSS Feed">
  <link rel="alternate" type="application/atom+xml" href="https://www.banli17.com/feed.atom" title=" Atom Feed">
  <link rel="alternate" type="application/json" href="https://www.banli17.com/feed.json" title=" JSON Feed">
    
    <link rel="preload" href="/assets/css/0.styles.f0bd4ff2.css" as="style"><link rel="preload" href="/assets/js/app.ddcb1e58.js" as="script"><link rel="preload" href="/assets/js/2.8ca4622d.js" as="script"><link rel="preload" href="/assets/js/48.ef1b41dc.js" as="script"><link rel="prefetch" href="/assets/js/10.a3051333.js"><link rel="prefetch" href="/assets/js/11.e55c93da.js"><link rel="prefetch" href="/assets/js/12.d7314c01.js"><link rel="prefetch" href="/assets/js/13.1b0f4193.js"><link rel="prefetch" href="/assets/js/14.170b8e97.js"><link rel="prefetch" href="/assets/js/15.69e4b704.js"><link rel="prefetch" href="/assets/js/16.28ca2597.js"><link rel="prefetch" href="/assets/js/17.707b50cd.js"><link rel="prefetch" href="/assets/js/18.a7917360.js"><link rel="prefetch" href="/assets/js/19.1af4700f.js"><link rel="prefetch" href="/assets/js/20.5c785367.js"><link rel="prefetch" href="/assets/js/21.387d547a.js"><link rel="prefetch" href="/assets/js/22.7016a999.js"><link rel="prefetch" href="/assets/js/23.9b5391fb.js"><link rel="prefetch" href="/assets/js/24.4b1a8ff8.js"><link rel="prefetch" href="/assets/js/25.daffa69c.js"><link rel="prefetch" href="/assets/js/26.f81c1451.js"><link rel="prefetch" href="/assets/js/27.76620326.js"><link rel="prefetch" href="/assets/js/28.57257baa.js"><link rel="prefetch" href="/assets/js/29.f476d1ed.js"><link rel="prefetch" href="/assets/js/3.aee8aba4.js"><link rel="prefetch" href="/assets/js/30.84da00cf.js"><link rel="prefetch" href="/assets/js/31.2524b2a5.js"><link rel="prefetch" href="/assets/js/32.eed83251.js"><link rel="prefetch" href="/assets/js/33.023cbcd0.js"><link rel="prefetch" href="/assets/js/34.5ec3e6c1.js"><link rel="prefetch" href="/assets/js/35.6677a1b0.js"><link rel="prefetch" href="/assets/js/36.c1a88897.js"><link rel="prefetch" href="/assets/js/37.657b0c90.js"><link rel="prefetch" href="/assets/js/38.380dae1f.js"><link rel="prefetch" href="/assets/js/39.ed5ae81d.js"><link rel="prefetch" href="/assets/js/4.b06fce9e.js"><link rel="prefetch" href="/assets/js/40.72822060.js"><link rel="prefetch" href="/assets/js/41.27f3079f.js"><link rel="prefetch" href="/assets/js/42.8d95e1db.js"><link rel="prefetch" href="/assets/js/43.cd2db977.js"><link rel="prefetch" href="/assets/js/44.056076b8.js"><link rel="prefetch" href="/assets/js/45.b87366dd.js"><link rel="prefetch" href="/assets/js/46.d9bac770.js"><link rel="prefetch" href="/assets/js/47.91fa3e96.js"><link rel="prefetch" href="/assets/js/49.5dab8c33.js"><link rel="prefetch" href="/assets/js/5.8ed1b274.js"><link rel="prefetch" href="/assets/js/50.c5ba4912.js"><link rel="prefetch" href="/assets/js/51.6c5137fe.js"><link rel="prefetch" href="/assets/js/52.5b9daf5a.js"><link rel="prefetch" href="/assets/js/53.6ee7bd8e.js"><link rel="prefetch" href="/assets/js/54.b5c4258e.js"><link rel="prefetch" href="/assets/js/55.06119a8d.js"><link rel="prefetch" href="/assets/js/56.a507d1bb.js"><link rel="prefetch" href="/assets/js/57.41a3dd62.js"><link rel="prefetch" href="/assets/js/58.afcf635c.js"><link rel="prefetch" href="/assets/js/59.3fb47d73.js"><link rel="prefetch" href="/assets/js/6.8fd2deac.js"><link rel="prefetch" href="/assets/js/60.0c5f552e.js"><link rel="prefetch" href="/assets/js/61.4b7caf71.js"><link rel="prefetch" href="/assets/js/62.e7808bca.js"><link rel="prefetch" href="/assets/js/63.34bc6cf5.js"><link rel="prefetch" href="/assets/js/64.4b44ef20.js"><link rel="prefetch" href="/assets/js/65.3e69f8fc.js"><link rel="prefetch" href="/assets/js/66.b094abbd.js"><link rel="prefetch" href="/assets/js/67.d082b797.js"><link rel="prefetch" href="/assets/js/68.53cfa646.js"><link rel="prefetch" href="/assets/js/7.9fa916e3.js"><link rel="prefetch" href="/assets/js/8.7de33ad4.js"><link rel="prefetch" href="/assets/js/9.61bb59c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f0bd4ff2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/f2e/html/1.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/project/" class="nav-link router-link-active">工程化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">sql 必知必会</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algo/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/task/2019.html" class="nav-link">安排</a></div><div class="nav-item"><a href="https://github.com/banli17" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/f2e/html/1.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/project/" class="nav-link router-link-active">工程化</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">sql 必知必会</a></li><li class="dropdown-item"><!----> <a href="/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/mongo/" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/language/japanese/" class="nav-link">redis</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">网络协议</a></li><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">计算机组成原理</a></li><li class="dropdown-item"><!----> <a href="/language/chinese/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/algo/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/task/2019.html" class="nav-link">安排</a></div><div class="nav-item"><a href="https://github.com/banli17" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/project/" class="sidebar-link">简介</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程规范化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="了解-babel-的使用和原理"><a href="#了解-babel-的使用和原理" aria-hidden="true" class="header-anchor">#</a> 了解 babel 的使用和原理</h1> <p>babel 是用来将高版本的 js 编译成低版本 js 的工具。</p> <p>首先安装<code>babel-cli</code>、<code>babel-preset-env</code>。</p> <p>然后新建一个<code>.babelrc</code>文件，添加配置。</p> <div class="language- extra-class"><pre class="language-text"><code>// .babelrc
{
    presets: ['env']
}
</code></pre></div><ul><li>babel-cli: babel 的命令行工具</li></ul> <p>如果不配置<code>.babelrc</code>文件，直接使用<code>babel 1.js -o 2.js</code>，将会原样输出。
<code>-o</code> 是 <code>--out-file</code>的简写，是输出编译结果到单个文件。
如果想每次修改文件后编译文件，加<code>--watch</code>或<code>-w</code>，<code>-w</code>要在<code>-o</code>之前写，否则报错文件不存在。</p> <p><code>babel src/*.js -w -o *.js</code>将会把 js 文件合并到一个 js 输出，这个 js 的名字是第一个 js 的名字。</p> <p><code>--source-maps</code>或<code>-s</code>表示添加 source map 文件。如果要内联，则是<code>-source-maps inline</code>，会生成一个.js.map 文件。</p> <p><code>--out-dir</code>或<code>-d</code>可以将整个 src 目录编译输出到 lib 目录。</p> <div class="language- extra-class"><pre class="language-text"><code>// 正确
babel src -d build   // 编译整个目录到build目录
babel src -d build.js   // 编译整个目录到build.js

// 错误，会生成 build/src...
babel src/*.js -d build
</code></pre></div><p>忽略文件 <code>--ignore spec.js,text.js</code></p> <p>复制不需要编译的文件 <code>--copy-files</code></p> <p>传输文件 <code>babel -o 1.js &lt; 2.js</code></p> <p>使用插件 <code>--plugins=transform-runtime,transform-es2015-modules-amd</code></p> <p>使用 presets <code>--presets=es2015,react</code></p> <p>忽略.babelrc 文件的配置并使用 cli 选项</p> <div class="language- extra-class"><pre class="language-text"><code>babel --no-babelrc script.js --out-file script-compiled.js --presets=es2015,react
</code></pre></div><h2 id="babel-register"><a href="#babel-register" aria-hidden="true" class="header-anchor">#</a> babel-register</h2> <p>babel-register 模块改写 require 命令，为它加上一个钩子。此后，每当使用 require 加载.js、.jsx、.es 和.es6 后缀名的文件，就会先用 Babel 进行转码。</p> <p>使用时，必须首先加载 babel-register。</p> <div class="language- extra-class"><pre class="language-text"><code>require(&quot;babel-register&quot;);
require(&quot;./index.js&quot;);
</code></pre></div><p>然后，就不需要手动对 index.js 转码了。</p> <p>需要注意的是，<code>babel-register</code>只会对 require 命令加载的文件转码，而不会对当前文件转码。另外，由于它是实时转码，所以只适合在开发环境使用。</p> <p>不过现在<code>node8</code>都已经支持<code>es6</code>语法了，所以不太需要这货。</p> <div class="language- extra-class"><pre class="language-text"><code>function loader(m, filename) {
  m._compile(compile(filename), filename);
}

function registerExtension(ext) {
  var old = oldHandlers[ext] || oldHandlers[&quot;.js&quot;] || require.extensions[&quot;.js&quot;];

  require.extensions[ext] = function (m, filename) {
    if (shouldIgnore(filename)) {
      old(m, filename);
    } else {
      loader(m, filename, old);
    }
  };
}
</code></pre></div><p>通过定义 require.extensions 方法，可以覆盖 require 方法，这样调用 require 的时候，就可以走 babel 的编译，然后使用 m._compile 方法运行代码。</p> <h2 id="babel-node"><a href="#babel-node" aria-hidden="true" class="header-anchor">#</a> babel-node</h2> <p><code>babel-node</code>可以直接形成一个支持 es6 语法的 node 环境，在开发环境中执行代码时可以用它来代替 node。</p> <h2 id="babel-core"><a href="#babel-core" aria-hidden="true" class="header-anchor">#</a> babel-core</h2> <p><code>babel-core</code>是以编程的方式使用 babel,可以用来将某段代码或某个文件转换成一个对象<code>{code, map, ast}</code>。</p> <p><code>ast</code>表示 <a href="http://www.iteye.com/news/30731" target="_blank" rel="noopener noreferrer">Abstract Syntax Tree<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language- extra-class"><pre class="language-text"><code>var babel = require('babel-core');

var obj = babel.transform('()=&gt;{}', {
	sourceMaps: true,
	presets: ['env']
});

console.log(obj);  // {code, map, ast}
</code></pre></div><ul><li>babel.transformFile(&quot;filename.js&quot;, options)</li> <li>babel.transformFileSync(&quot;filename.js&quot;, options)</li> <li>babel.transformFromAst(ast: Object, code?: string, options?: Object)</li></ul> <h2 id="配置-babel"><a href="#配置-babel" aria-hidden="true" class="header-anchor">#</a> 配置 Babel</h2> <p>要使用 babel，需要通过<code>presets</code>和<code>plugins</code>来告诉 babel 做什么。</p> <p><strong>.babelrc</strong></p> <ul><li>babel-preset-es2015</li> <li>babel-preset-react 转义 react 语法</li> <li>babel-preset-stage-x
<ul><li>0 提议</li> <li>1 草稿</li> <li>2 定稿</li> <li>3 浏览器实验。如果可以，下一年就发布</li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;presets&quot;: [
      &quot;es2015&quot;,
      &quot;react&quot;,
      &quot;stage-2&quot;
    ],
    &quot;plugins&quot;: []
}
</code></pre></div><p>babel 可以编译所有的新语法，但是 API 不能保证。</p> <p><code>babel-polyfill</code>用来将新 API，比如做一个<code>Array.from</code>垫片。babel 的垫片库是<a href="https://github.com/zloirock/core-js" target="_blank" rel="noopener noreferrer">core-js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。要使用它，只需要在文件顶部加入<code>import &quot;babel-polyfill&quot;</code>即可。</p> <ul><li>babel 默认会将新语法比如 class 转成函数_classCallCheck，但是每个模块文件都会新生成一遍。通过启用<code>babel-plugin-transform-runtime</code>可以在转化时 require 调用<code>babel-runtime</code>里面的方法，达到复用。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// 提取出来是依赖babel-runtime的
var _classCallCheck2 = require(&quot;babel-runtime/helpers/classCallCheck&quot;);

// 配置
{
    &quot;plugins&quot;: [
      &quot;transform-runtime&quot;,
      &quot;transform-es2015-classes&quot;
    ]
  }
</code></pre></div><h2 id="手动指定预设"><a href="#手动指定预设" aria-hidden="true" class="header-anchor">#</a> 手动指定预设</h2> <p>可以手动指定预设</p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save-dev babel-plugin-transform-es2015-classes

{
   &quot;plugins&quot;: [
     &quot;transform-es2015-classes&quot;
   ]
}
</code></pre></div><h2 id="根据环境配置-babel"><a href="#根据环境配置-babel" aria-hidden="true" class="header-anchor">#</a> 根据环境配置 babel</h2> <div class="language- extra-class"><pre class="language-text"><code>  {
    &quot;presets&quot;: [&quot;es2015&quot;],
    &quot;plugins&quot;: [],
+   &quot;env&quot;: {
+     &quot;development&quot;: {
+       &quot;plugins&quot;: [...]
+     },
+     &quot;production&quot;: {
+       &quot;plugins&quot;: [...]
+     }
    }
  }
</code></pre></div><p>当前环境可以使用 process.env.BABEL_ENV 来获得。 如果 BABEL_ENV 不可用，将会替换成 NODE_ENV，并且如果后者也没有设置，那么缺省值是&quot;development&quot;。.</p> <p>unix 在 npm script 里</p> <div class="language- extra-class"><pre class="language-text"><code>BABEL_ENV=production [command]
NODE_ENV=production [command]
</code></pre></div><p>windows 需要先 SET BABEL_ENV=production 在执行 command</p> <p>如果要统一，则使用<a href="https://www.npmjs.com/package/cross-env" target="_blank" rel="noopener noreferrer">cross-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="babel-的原理"><a href="#babel-的原理" aria-hidden="true" class="header-anchor">#</a> babel 的原理</h2> <p><code>babel</code>使用的引擎是<code>babylon</code>，它是 fork 的<code>acorn</code>项目。</p> <ul><li>acorn 引擎，解析 ast</li> <li>acorn-travesal 遍历 ast 树</li> <li>acorn-</li></ul> <p>babel 将源码转换成 ast，通过遍历 ast 树，对树做一些修改，然后将 ast 转成编译后的源码。</p> <p>babel 工作流程如下：</p> <ol><li>babylon 将 code 转 ast，如果有不符合 babel 语法的代码，就报错。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>var babylon = require('babylon')

let code = `
	let a =1,b=2;
	function sum(a,b){
		return a + b
	}
	sum(a , b)
`

let ast = babylon.parse(code)

console.log(ast)
</code></pre></div><ol start="2"><li>babel-traverse 用来遍历 ast 树，然后插件再进行转化。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>traverse(ast, {
	enter(path){
		let node = path.node
		// console.log(types.isFunctionDeclaration(node))
		if(types.isFunctionDeclaration(node)){
			path.replaceWithSourceString(`function add(a, b){
				return a+b
			}`)
		}
	}
});
</code></pre></div><p>babel-traverse 遍历树时，有 2 个钩子，enter 和 exit，enter 发生在进入当前节点，未进入子节点前。</p> <p>babel 的插件就是定义如何转换当前结点，所以从这里可以看出 babel 的插件能做的事情，只能转换 ast 树，而不能在作用在前序阶段（语法分析）</p> <p>babel 的插件体系分为两部分。</p> <ul><li>babel-preset-xxx</li> <li>babel-plugin-xxx</li></ul> <p>preset 和 plugin 其实是一个东西，preset 定义了一堆 plugin list。</p> <p>preset 是倒序的，plugin 是正序的。也就是说</p> <div class="language- extra-class"><pre class="language-text"><code>preset: ['es2015', 'react']
</code></pre></div><p>是先执行 react 插件，再用 es2015。</p> <ol start="3"><li>babel-generator 将 ast 树转成源码</li></ol> <div class="language- extra-class"><pre class="language-text"><code>let {code} = generator(ast)
</code></pre></div><h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="http://www.alloyteam.com/2017/04/analysis-of-babel-babel-overview/" target="_blank" rel="noopener noreferrer">剖析 Babel——Babel 总览<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.jb51.net/article/51476.htm" target="_blank" rel="noopener noreferrer">Node.js 中 require 的工作原理浅析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://babeljs.io/docs/plugins/" target="_blank" rel="noopener noreferrer">babel 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/q/1010000005596587" target="_blank" rel="noopener noreferrer">babel 的 polyfill 和 runtime 的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ddcb1e58.js" defer></script><script src="/assets/js/2.8ca4622d.js" defer></script><script src="/assets/js/48.ef1b41dc.js" defer></script>
  </body>
</html>
