<!DOCTYPE html>
<html lang=&#34;en&#34; data-theme=&#34;&#34;>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.d719e73e126f22665d27.css","/main.477abd2e0f7ae11842aa.js"],"component---site-src-pages-index-jsc-4-f-f99":["/component---site-src-pages-index-jsc-4-f-f99.7f8bb42332d3fb863b06.js"],"component---theme-blog-post-pageccc-cab":["/component---theme-blog-post-pageccc-cab.8e2d2ee446add4b2b98b.js"],"content---blog-2019-08-12-think-house-362-b31":["/content---blog-2019-08-12-think-house-362-b31.9dd4d64cef8935947cc6.js"],"metadata---blog-2019-08-12-think-house-3-b-6-904":["/metadata---blog-2019-08-12-think-house-3-b-6-904.d9830d5a5942cab785a0.js"],"component---theme-blog-list-pagea-6-a-7ba":["/component---theme-blog-list-pagea-6-a-7ba.0a21799c9e5ea3fceb3b.js"],"content---bloga-55-f4d":["/content---bloga-55-f4d.489c2054c790952ef46d.js"],"metadata---blog-92-a-15c":["/metadata---blog-92-a-15c.5ff7289cd93f83a7673d.js"],"component---theme-doc-legacy-page-9-e-7-ca5":["/component---theme-doc-legacy-page-9-e-7-ca5.3c38a2f40a51efdd72a0.css","/component---theme-doc-legacy-page-9-e-7-ca5.1085c0ca4dac1d879092.js"],"docsMetadata---docs-9-a-9-239":["/docsMetadata---docs-9-a-9-239.efc62167d7e7e974bd14.js"],"component---theme-doc-legacy-item-031-769":["/component---theme-doc-legacy-item-031-769.2f2552f02b6a918fee59.css","/component---theme-doc-legacy-item-031-769.63af36fb5b293fb44f17.js"],"content---docs-about-3-d-8-538":["/content---docs-about-3-d-8-538.b22f4002fb1de87b1230.js"],"metadata---docs-about-443-9ff":["/metadata---docs-about-443-9ff.73c084d649e4c149a16d.js"],"content---docs-base-compute-combinef-7-f-933":["/content---docs-base-compute-combinef-7-f-933.bbe804fc4e1766f967d3.js"],"metadata---docs-base-compute-combine-480-a12":["/metadata---docs-base-compute-combine-480-a12.3f3c4e034751065ae378.js"],"content---docs-database-mongo-2-c-4-a31":["/content---docs-database-mongo-2-c-4-a31.e91455dcec407920091d.js"],"metadata---docs-database-mongo-0-c-2-f76":["/metadata---docs-database-mongo-0-c-2-f76.af6ba28657bd992ab268.js"],"content---docs-algo-indexb-4-f-54a":["/content---docs-algo-indexb-4-f-54a.f544321e6098b7e21cb2.js"],"metadata---docs-algo-index-812-55b":["/metadata---docs-algo-index-812-55b.967a6c554af6d0ec71c7.js"],"content---docs-database-mysql-561-697":["/content---docs-database-mysql-561-697.8d9b06089ed38971996c.js"],"metadata---docs-database-mysql-2-f-1-3e5":["/metadata---docs-database-mysql-2-f-1-3e5.b8ec8aff626a76d0b3f1.js"],"content---docs-database-redise-5-d-9ae":["/content---docs-database-redise-5-d-9ae.8da280d7a5afc1ada019.js"],"metadata---docs-database-redis-4-a-0-66e":["/metadata---docs-database-redis-4-a-0-66e.1e20f9eb218cd3aaa120.js"],"content---docs-demo-index-648-2ab":["/content---docs-demo-index-648-2ab.7a9097eea3f4eb857d5f.js"],"metadata---docs-demo-indexa-04-089":["/metadata---docs-demo-indexa-04-089.d02205114cc145ec515a.js"],"content---docs-base-h-5586-54d":["/content---docs-base-h-5586-54d.2258338422d575187d27.js"],"metadata---docs-base-h-515-a-1cb":["/metadata---docs-base-h-515-a-1cb.50cde03a6341136d8e1e.js"],"content---docs-linux-fileec-1-765":["/content---docs-linux-fileec-1-765.b668459315fc826dbf36.js"],"metadata---docs-linux-file-65-c-c93":["/metadata---docs-linux-file-65-c-c93.06f1005462e771673c93.js"],"content---docs-linux-service-49-b-272":["/content---docs-linux-service-49-b-272.88cddff68450d2d288ad.js"],"metadata---docs-linux-serviceac-8-d7f":["/metadata---docs-linux-serviceac-8-d7f.a8db4496c4521adf47a9.js"],"content---docs-linux-soft-422-6cf":["/content---docs-linux-soft-422-6cf.5f724b64dea651a6dd94.js"],"metadata---docs-linux-softe-01-10b":["/metadata---docs-linux-softe-01-10b.dd8a48e3918d13d73eb8.js"],"content---docs-linux-indexcb-8-9a7":["/content---docs-linux-indexcb-8-9a7.f47eeb5f2d9d73fc2a84.js"],"metadata---docs-linux-index-73-e-38c":["/metadata---docs-linux-index-73-e-38c.753c4d1a4f0cce68c442.js"],"content---docs-nginx-index-16-d-468":["/content---docs-nginx-index-16-d-468.d2297635196c4020956c.js"],"metadata---docs-nginx-index-4-a-2-2e4":["/metadata---docs-nginx-index-4-a-2-2e4.0ab02bb90f0c7bc8d6bd.js"],"content---docs-nodejs-async-7-f-4-0af":["/content---docs-nodejs-async-7-f-4-0af.5454ce07fa8ff7325eaa.js"],"metadata---docs-nodejs-asyncc-40-22b":["/metadata---docs-nodejs-asyncc-40-22b.f8e18069e6bfba6ea18c.js"],"content---docs-nodejs-testaf-7-5fa":["/content---docs-nodejs-testaf-7-5fa.c53522930b8dc8c26e7c.js"],"metadata---docs-nodejs-testbf-0-08d":["/metadata---docs-nodejs-testbf-0-08d.a9a72c6fab71ce5736fd.js"],"content---docs-nodejs-safee-0-a-532":["/content---docs-nodejs-safee-0-a-532.656a522f1e2499551386.js"],"metadata---docs-nodejs-safe-287-46f":["/metadata---docs-nodejs-safe-287-46f.a48c917a3ab21d94ff84.js"],"content---docs-other-blogaab-295":["/content---docs-other-blogaab-295.90b83606127347166591.js"],"metadata---docs-other-blogc-8-f-558":["/metadata---docs-other-blogc-8-f-558.85a843134419b7762136.js"],"content---docs-nodejs-utild-25-062":["/content---docs-nodejs-utild-25-062.7abc674669aa1b8e7b27.js"],"metadata---docs-nodejs-util-0-fd-711":["/metadata---docs-nodejs-util-0-fd-711.d07acf2cb8f71bdf235d.js"],"content---docs-other-maced-3-b03":["/content---docs-other-maced-3-b03.144f24782733bff7f170.js"],"metadata---docs-other-macc-8-c-bc8":["/metadata---docs-other-macc-8-c-bc8.f1056687ee296d57433a.js"],"content---docs-other-kindle-rss-789-941":["/content---docs-other-kindle-rss-789-941.191a58e9a0d6983d3b18.js"],"metadata---docs-other-kindle-rssb-06-572":["/metadata---docs-other-kindle-rssb-06-572.56dbcb3d237d53220829.js"],"content---docs-patterns-action-61-d-c76":["/content---docs-patterns-action-61-d-c76.1db7f876e899fec516eb.js"],"metadata---docs-patterns-action-124-4bd":["/metadata---docs-patterns-action-124-4bd.81816e08d7e197fbc992.js"],"content---docs-other-resourceea-2-ecf":["/content---docs-other-resourceea-2-ecf.79aff6c31eaaa438938c.js"],"metadata---docs-other-resource-348-7b5":["/metadata---docs-other-resource-348-7b5.f36a0245c8152f928000.js"],"content---docs-patterns-bridge-335-1e9":["/content---docs-patterns-bridge-335-1e9.b15592c2851328564e6b.js"],"metadata---docs-patterns-bridgefbb-495":["/metadata---docs-patterns-bridgefbb-495.36847cfe0994f3493cb7.js"],"content---docs-patterns-adapter-555-7ec":["/content---docs-patterns-adapter-555-7ec.2112961b332c479ac795.js"],"metadata---docs-patterns-adapter-464-f76":["/metadata---docs-patterns-adapter-464-f76.5b7ed24c6f3769df781c.js"],"content---docs-patterns-chain-of-responsibility-579-dfa":["/content---docs-patterns-chain-of-responsibility-579-dfa.66dea4296433b6cf98c9.js"],"metadata---docs-patterns-chain-of-responsibility-014-8a0":["/metadata---docs-patterns-chain-of-responsibility-014-8a0.3df75643a5b906e0e95e.js"],"content---docs-patterns-builder-5-e-5-e3a":["/content---docs-patterns-builder-5-e-5-e3a.e6629fbefca8e3a8aac2.js"],"metadata---docs-patterns-builderead-d21":["/metadata---docs-patterns-builderead-d21.d2361792867897216584.js"],"content---docs-patterns-commande-85-4af":["/content---docs-patterns-commande-85-4af.2c197182cb87c0ae1f68.js"],"metadata---docs-patterns-command-80-a-50e":["/metadata---docs-patterns-command-80-a-50e.9f9dded3c382b0277e99.js"],"content---docs-patterns-composite-33-e-80d":["/content---docs-patterns-composite-33-e-80d.2dd077321435164de2fc.js"],"metadata---docs-patterns-composite-238-38a":["/metadata---docs-patterns-composite-238-38a.0501a960cff28811d86b.js"],"content---docs-patterns-decorator-944-f6d":["/content---docs-patterns-decorator-944-f6d.231b091ccecdcf27e54c.js"],"metadata---docs-patterns-decorator-142-9e2":["/metadata---docs-patterns-decorator-142-9e2.af6480bb05e36aaf5bbc.js"],"content---docs-patterns-facade-4-ef-b2f":["/content---docs-patterns-facade-4-ef-b2f.2f3608c06db80e48fffa.js"],"metadata---docs-patterns-facade-7-a-8-297":["/metadata---docs-patterns-facade-7-a-8-297.8994ec660f8979f26d3f.js"],"content---docs-patterns-factoryf-00-197":["/content---docs-patterns-factoryf-00-197.a5183b1395d1ee6b4c04.js"],"metadata---docs-patterns-factory-659-5cc":["/metadata---docs-patterns-factory-659-5cc.64975baaafd3bc6b0d9a.js"],"content---docs-patterns-flyweighte-43-831":["/content---docs-patterns-flyweighte-43-831.e3ac10a150bc7e94cbc5.js"],"metadata---docs-patterns-flyweightaba-d18":["/metadata---docs-patterns-flyweightaba-d18.e87d091a67e991b4cbee.js"],"content---docs-patterns-index-90-d-78a":["/content---docs-patterns-index-90-d-78a.40dac31f5fafd19ace72.js"],"metadata---docs-patterns-index-63-b-9e3":["/metadata---docs-patterns-index-63-b-9e3.3a645f801826c6531d22.js"],"content---docs-patterns-interpreterc-34-4ff":["/content---docs-patterns-interpreterc-34-4ff.b26bdf0f10f33e86db6e.js"],"metadata---docs-patterns-interpreter-484-b15":["/metadata---docs-patterns-interpreter-484-b15.8bf5662275ef37990978.js"],"content---docs-patterns-mediator-685-4ef":["/content---docs-patterns-mediator-685-4ef.af8aaa2f6c46fba56ffa.js"],"metadata---docs-patterns-mediator-421-d91":["/metadata---docs-patterns-mediator-421-d91.37e0d59a654f39db1d68.js"],"content---docs-patterns-iterator-3-bc-1d4":["/content---docs-patterns-iterator-3-bc-1d4.553678cbac18b755d2c1.js"],"metadata---docs-patterns-iterator-288-f03":["/metadata---docs-patterns-iterator-288-f03.096363b38361bcc943f6.js"],"content---docs-patterns-memento-740-286":["/content---docs-patterns-memento-740-286.883958ef8d16f3e8537c.js"],"metadata---docs-patterns-memento-098-f69":["/metadata---docs-patterns-memento-098-f69.a737176f488438f1d246.js"],"content---docs-patterns-observer-73-f-441":["/content---docs-patterns-observer-73-f-441.ab60d4d039ef9ba8920d.js"],"metadata---docs-patterns-observere-90-4f8":["/metadata---docs-patterns-observere-90-4f8.6ced65f460928095c70c.js"],"content---docs-patterns-proxyb-6-e-4ef":["/content---docs-patterns-proxyb-6-e-4ef.cca080c448d090f41be7.js"],"metadata---docs-patterns-proxye-47-a3c":["/metadata---docs-patterns-proxye-47-a3c.234134dcae7db5ad9a43.js"],"content---docs-patterns-singleton-710-727":["/content---docs-patterns-singleton-710-727.45783f8b86cf328f4660.js"],"metadata---docs-patterns-singletonb-35-b33":["/metadata---docs-patterns-singletonb-35-b33.e4410205e4b63b2b0192.js"],"content---docs-patterns-prototype-93-c-d70":["/content---docs-patterns-prototype-93-c-d70.28f4edaac5325115ccb2.js"],"metadata---docs-patterns-prototype-8-ac-89b":["/metadata---docs-patterns-prototype-8-ac-89b.81c1926ddca4c0ee17c5.js"],"content---docs-patterns-stated-4-a-502":["/content---docs-patterns-stated-4-a-502.aff490fbcfbd4d613e22.js"],"metadata---docs-patterns-stateb-04-819":["/metadata---docs-patterns-stateb-04-819.dbfb7b76a5f0bf1070ef.js"],"content---docs-patterns-strategy-9-e-9-61c":["/content---docs-patterns-strategy-9-e-9-61c.2154ac691f82d145481e.js"],"metadata---docs-patterns-strategy-6-ce-04f":["/metadata---docs-patterns-strategy-6-ce-04f.dc13e188379edea75baf.js"],"content---docs-patterns-templateee-1-6e8":["/content---docs-patterns-templateee-1-6e8.99542a775d4d7331ab97.js"],"metadata---docs-patterns-template-3-bc-bf3":["/metadata---docs-patterns-template-3-bc-bf3.daecb8563311a626ef0b.js"],"content---docs-patterns-visitorff-6-bda":["/content---docs-patterns-visitorff-6-bda.4551872699bc75006cb1.js"],"metadata---docs-patterns-visitore-38-a38":["/metadata---docs-patterns-visitore-38-a38.6c1f416beb83d0fa4cc5.js"],"content---docs-base-net-tcpd-0-c-487":["/content---docs-base-net-tcpd-0-c-487.ded6692aa2655c6522aa.js"],"metadata---docs-base-net-tcp-212-c6f":["/metadata---docs-base-net-tcp-212-c6f.8dd35e78bad2b65b9006.js"],"content---docs-f-2-e-browser-cache-260-909":["/content---docs-f-2-e-browser-cache-260-909.edf99a580762ddae6c5e.js"],"metadata---docs-f-2-e-browser-cache-361-a94":["/metadata---docs-f-2-e-browser-cache-361-a94.28e7216342319a1a6962.js"],"content---docs-base-net-http-1-cc-352":["/content---docs-base-net-http-1-cc-352.8c0532a7b7d2b66979ee.js"],"metadata---docs-base-net-http-373-f55":["/metadata---docs-base-net-http-373-f55.a21647d861d5aaf9bd51.js"],"content---docs-f-2-e-browser-eventa-5-d-93e":["/content---docs-f-2-e-browser-eventa-5-d-93e.ecfddb3e4b879bc8d4a6.js"],"metadata---docs-f-2-e-browser-event-0-cc-f3c":["/metadata---docs-f-2-e-browser-event-0-cc-f3c.eb85d5e63ff050f42c82.js"],"content---docs-f-2-e-browser-devtool-850-efc":["/content---docs-f-2-e-browser-devtool-850-efc.5b23ab4200958d1b3637.js"],"metadata---docs-f-2-e-browser-devtool-3-ab-d05":["/metadata---docs-f-2-e-browser-devtool-3-ab-d05.9fe5ea30673d765636ce.js"],"content---docs-f-2-e-browser-eventloop-473-bc4":["/content---docs-f-2-e-browser-eventloop-473-bc4.88281ef36c33f14955d2.js"],"metadata---docs-f-2-e-browser-eventloopcbb-9eb":["/metadata---docs-f-2-e-browser-eventloopcbb-9eb.44ebbe5e3e5a0be45b22.js"],"content---docs-f-2-e-browser-fetch-147-732":["/content---docs-f-2-e-browser-fetch-147-732.73df2df1c899b03dcdb5.js"],"metadata---docs-f-2-e-browser-fetch-918-58f":["/metadata---docs-f-2-e-browser-fetch-918-58f.67ea03597bbedee8f8cb.js"],"content---docs-f-2-e-browser-storage-0-e-2-cd2":["/content---docs-f-2-e-browser-storage-0-e-2-cd2.e4c1c246ee4ee3ef5ef5.js"],"metadata---docs-f-2-e-browser-storagea-21-a7b":["/metadata---docs-f-2-e-browser-storagea-21-a7b.2693ccc675c0f98748f7.js"],"content---docs-f-2-e-browser-dom-018-426":["/content---docs-f-2-e-browser-dom-018-426.407ac50822c262f3ea09.js"],"metadata---docs-f-2-e-browser-domb-41-90c":["/metadata---docs-f-2-e-browser-domb-41-90c.40c3d9385d9932dc62ef.js"],"content---docs-f-2-e-browser-v-8-c-83-515":["/content---docs-f-2-e-browser-v-8-c-83-515.25aa6d0bfec445cd0539.js"],"metadata---docs-f-2-e-browser-v-8-e-60-c45":["/metadata---docs-f-2-e-browser-v-8-e-60-c45.772e0b55782ed70ec81e.js"],"content---docs-f-2-e-browser-work-31-f-d77":["/content---docs-f-2-e-browser-work-31-f-d77.a0c465be0361c3dbe22c.js"],"metadata---docs-f-2-e-browser-work-9-d-7-1ef":["/metadata---docs-f-2-e-browser-work-9-d-7-1ef.259c8c7b2df2b3dead04.js"],"content---docs-f-2-e-css-indexf-55-541":["/content---docs-f-2-e-css-indexf-55-541.f41dc6a33da05bec58f8.js"],"metadata---docs-f-2-e-css-indexe-08-461":["/metadata---docs-f-2-e-css-indexe-08-461.621a33c5d05c74a2bd99.js"],"content---docs-f-2-e-html-index-9-d-1-79a":["/content---docs-f-2-e-html-index-9-d-1-79a.aa737df8610ee0edd562.js"],"metadata---docs-f-2-e-html-index-24-f-1e4":["/metadata---docs-f-2-e-html-index-24-f-1e4.70a9dd97a9cd531129d0.js"],"content---docs-f-2-e-javascript-grammer-447-369":["/content---docs-f-2-e-javascript-grammer-447-369.f7b80ec1b5e8db94c92a.js"],"metadata---docs-f-2-e-javascript-grammer-6-df-3af":["/metadata---docs-f-2-e-javascript-grammer-6-df-3af.23d93ed5348e42d4d908.js"],"content---docs-f-2-e-javascript-modulee-10-ff1":["/content---docs-f-2-e-javascript-modulee-10-ff1.e8c585a2b0b180b14c2f.js"],"metadata---docs-f-2-e-javascript-moduleee-6-b43":["/metadata---docs-f-2-e-javascript-moduleee-6-b43.a7967cffe7804555bfc9.js"],"content---docs-f-2-e-monitor-index-391-ad0":["/content---docs-f-2-e-monitor-index-391-ad0.503db2e8f3fe2efaa097.js"],"metadata---docs-f-2-e-monitor-indexa-56-d7f":["/metadata---docs-f-2-e-monitor-indexa-56-d7f.970c636d0c0ec47b0bf0.js"],"content---docs-f-2-e-javascript-asynceb-2-d37":["/content---docs-f-2-e-javascript-asynceb-2-d37.1d92b62388af21ab94de.js"],"metadata---docs-f-2-e-javascript-async-09-f-030":["/metadata---docs-f-2-e-javascript-async-09-f-030.25a7228490d4cf49f2b2.js"],"content---docs-f-2-e-javascript-oop-3-a-2-e5a":["/content---docs-f-2-e-javascript-oop-3-a-2-e5a.c65260e27d9db92b251e.js"],"metadata---docs-f-2-e-javascript-oopaa-3-9b9":["/metadata---docs-f-2-e-javascript-oopaa-3-9b9.e942231bbc0e495f0e6a.js"],"content---docs-f-2-e-javascript-skill-687-c8f":["/content---docs-f-2-e-javascript-skill-687-c8f.74bd2f75577a97336731.js"],"metadata---docs-f-2-e-javascript-skilld-97-3a2":["/metadata---docs-f-2-e-javascript-skilld-97-3a2.cd114e7df341a974907b.js"],"content---docs-f-2-e-javascript-regexp-987-85e":["/content---docs-f-2-e-javascript-regexp-987-85e.42bab3214e526417d3cf.js"],"metadata---docs-f-2-e-javascript-regexp-239-ff9":["/metadata---docs-f-2-e-javascript-regexp-239-ff9.ba4fb34bdc5dcc94e0bf.js"],"content---docs-f-2-e-javascript-type-58-e-e47":["/content---docs-f-2-e-javascript-type-58-e-e47.5ad3368307959460988d.js"],"metadata---docs-f-2-e-javascript-typef-33-dde":["/metadata---docs-f-2-e-javascript-typef-33-dde.e96ec684ec8263d46c9d.js"],"content---docs-f-2-e-performance-indexaef-e1d":["/content---docs-f-2-e-performance-indexaef-e1d.a19b9d087cde8aa1b16c.js"],"metadata---docs-f-2-e-performance-index-3-de-87c":["/metadata---docs-f-2-e-performance-index-3-de-87c.fa958c859c38b85285c6.js"],"content---docs-f-2-e-react-index-0-cb-3f0":["/content---docs-f-2-e-react-index-0-cb-3f0.815aee0de96f4a421b3b.js"],"metadata---docs-f-2-e-react-indexc-85-6a6":["/metadata---docs-f-2-e-react-indexc-85-6a6.c4cf5f74ba2e693a1574.js"],"content---docs-f-2-e-react-native-alert-6-d-1-303":["/content---docs-f-2-e-react-native-alert-6-d-1-303.a904ff079c64362e4f44.js"],"metadata---docs-f-2-e-react-native-alert-5-f-9-3e3":["/metadata---docs-f-2-e-react-native-alert-5-f-9-3e3.7968965bd72899a9fafe.js"],"content---docs-f-2-e-react-native-androide-34-3a4":["/content---docs-f-2-e-react-native-androide-34-3a4.117d7a94fad5167e51ad.js"],"metadata---docs-f-2-e-react-native-android-0-b-3-456":["/metadata---docs-f-2-e-react-native-android-0-b-3-456.1636cbe5df919bbf3734.js"],"content---docs-f-2-e-react-native-camera-597-89d":["/content---docs-f-2-e-react-native-camera-597-89d.59bbc0f5548e77f8f4dd.js"],"metadata---docs-f-2-e-react-native-camera-27-a-253":["/metadata---docs-f-2-e-react-native-camera-27-a-253.3005b4f4738ea37d8732.js"],"content---docs-f-2-e-react-native-bugly-8-d-4-ab2":["/content---docs-f-2-e-react-native-bugly-8-d-4-ab2.d2acf37aa28e499cfb67.js"],"metadata---docs-f-2-e-react-native-buglyadb-596":["/metadata---docs-f-2-e-react-native-buglyadb-596.3394199ee5fbf770c1f4.js"],"content---docs-f-2-e-react-native-deploy-500-e54":["/content---docs-f-2-e-react-native-deploy-500-e54.fbe7dc438cca9b471128.js"],"metadata---docs-f-2-e-react-native-deploy-4-cf-03c":["/metadata---docs-f-2-e-react-native-deploy-4-cf-03c.42e8179692e50d9f2fa9.js"],"content---docs-f-2-e-react-native-code-pusha-39-174":["/content---docs-f-2-e-react-native-code-pusha-39-174.a2b0a669c96b1cdfaf9c.js"],"metadata---docs-f-2-e-react-native-code-push-7-b-7-231":["/metadata---docs-f-2-e-react-native-code-push-7-b-7-231.d1b2c854735aec9d02de.js"],"content---docs-f-2-e-react-native-form-7-a-1-0fb":["/content---docs-f-2-e-react-native-form-7-a-1-0fb.2edc8f77f59028df5ad3.js"],"metadata---docs-f-2-e-react-native-form-69-e-589":["/metadata---docs-f-2-e-react-native-form-69-e-589.7d39120ee98e8a5d6192.js"],"content---docs-f-2-e-react-native-fetch-756-af5":["/content---docs-f-2-e-react-native-fetch-756-af5.18e0f039ff3be3fe54ec.js"],"metadata---docs-f-2-e-react-native-fetchd-41-27d":["/metadata---docs-f-2-e-react-native-fetchd-41-27d.56ddedd34e8ac926dcc9.js"],"content---docs-f-2-e-react-native-issue-0-f-6-864":["/content---docs-f-2-e-react-native-issue-0-f-6-864.2d17cdbc4910fa8fe779.js"],"metadata---docs-f-2-e-react-native-issue-214-5cd":["/metadata---docs-f-2-e-react-native-issue-214-5cd.50942c03421bf7c141a7.js"],"content---docs-f-2-e-react-native-gitf-9-e-d83":["/content---docs-f-2-e-react-native-gitf-9-e-d83.dd440a13b75c0c6c9de6.js"],"metadata---docs-f-2-e-react-native-git-3-f-0-1e2":["/metadata---docs-f-2-e-react-native-git-3-f-0-1e2.1303c9e04bf2f36d0e06.js"],"content---docs-f-2-e-react-native-loading-84-c-73a":["/content---docs-f-2-e-react-native-loading-84-c-73a.65ca63a01b7b73bce402.js"],"metadata---docs-f-2-e-react-native-loadingf-98-f5d":["/metadata---docs-f-2-e-react-native-loadingf-98-f5d.63d4a7c73f4e5252a780.js"],"content---docs-f-2-e-react-native-index-889-a61":["/content---docs-f-2-e-react-native-index-889-a61.6cf777c526246692245b.js"],"metadata---docs-f-2-e-react-native-indexb-92-e43":["/metadata---docs-f-2-e-react-native-indexb-92-e43.e937a026ddf6a55d3c88.js"],"content---docs-f-2-e-react-native-share-to-wechatf-7-d-17b":["/content---docs-f-2-e-react-native-share-to-wechatf-7-d-17b.c1714b30c6abed71a055.js"],"metadata---docs-f-2-e-react-native-share-to-wechatd-32-d2a":["/metadata---docs-f-2-e-react-native-share-to-wechatd-32-d2a.48c72ec3aec362b7906f.js"],"content---docs-f-2-e-react-native-react-native-videoc-1-d-e43":["/content---docs-f-2-e-react-native-react-native-videoc-1-d-e43.cfbf91fed2c4623a6b3a.js"],"metadata---docs-f-2-e-react-native-react-native-video-97-c-eaa":["/metadata---docs-f-2-e-react-native-react-native-video-97-c-eaa.6710af3d91d98cca7324.js"],"content---docs-f-2-e-react-native-size-5-b-4-c24":["/content---docs-f-2-e-react-native-size-5-b-4-c24.65d77f6a064b0605331f.js"],"metadata---docs-f-2-e-react-native-sizefa-9-e54":["/metadata---docs-f-2-e-react-native-sizefa-9-e54.7f25ffec75b11ea6df77.js"],"content---docs-f-2-e-react-native-save-to-camera-693-68d":["/content---docs-f-2-e-react-native-save-to-camera-693-68d.59f7e8c3896af23a1bc5.js"],"metadata---docs-f-2-e-react-native-save-to-camera-7-a-4-735":["/metadata---docs-f-2-e-react-native-save-to-camera-7-a-4-735.86ebaa9c12e9f9eb3b00.js"],"content---docs-f-2-e-react-native-source-877-2ea":["/content---docs-f-2-e-react-native-source-877-2ea.acf2e5e3a1130e890d40.js"],"metadata---docs-f-2-e-react-native-source-9-b-5-f09":["/metadata---docs-f-2-e-react-native-source-9-b-5-f09.eba1114d7802361bed43.js"],"content---docs-f-2-e-react-native-tech-226-30f":["/content---docs-f-2-e-react-native-tech-226-30f.f3c520f2a64e6686cd7b.js"],"metadata---docs-f-2-e-react-native-techbca-407":["/metadata---docs-f-2-e-react-native-techbca-407.60e8005e9f5a4d90463f.js"],"content---docs-f-2-e-react-native-waterfall-629-6ad":["/content---docs-f-2-e-react-native-waterfall-629-6ad.c9d69ecd70b3af367874.js"],"metadata---docs-f-2-e-react-native-waterfall-2-d-9-e37":["/metadata---docs-f-2-e-react-native-waterfall-2-d-9-e37.6586128947e8ed32f960.js"],"content---docs-f-2-e-react-native-update-rn-93-f-50e":["/content---docs-f-2-e-react-native-update-rn-93-f-50e.7e2e2a951faab482273b.js"],"metadata---docs-f-2-e-react-native-update-rn-323-92d":["/metadata---docs-f-2-e-react-native-update-rn-323-92d.49766a88b8b68b2070db.js"],"content---docs-f-2-e-react-native-wechate-7-f-088":["/content---docs-f-2-e-react-native-wechate-7-f-088.6a6ebdeabe884a34c622.js"],"metadata---docs-f-2-e-react-native-wechate-47-3f8":["/metadata---docs-f-2-e-react-native-wechate-47-3f8.eae10f64ddc42ecc50cb.js"],"content---docs-f-2-e-safe-index-165-7db":["/content---docs-f-2-e-safe-index-165-7db.4b6e7f8e05e788bbb2e6.js"],"metadata---docs-f-2-e-safe-index-647-b0c":["/metadata---docs-f-2-e-safe-index-647-b0c.ebb3ccf6c878ce3fd8ac.js"],"content---docs-f-2-e-test-index-1-ae-bf1":["/content---docs-f-2-e-test-index-1-ae-bf1.f1822f2f4ac5eea69f74.js"],"metadata---docs-f-2-e-test-index-47-d-1a6":["/metadata---docs-f-2-e-test-index-47-d-1a6.f5a7d1897db19fd43e79.js"],"content---docs-f-2-e-test-jestfc-3-df1":["/content---docs-f-2-e-test-jestfc-3-df1.d040b9a2bcc6ee4112db.js"],"metadata---docs-f-2-e-test-jestda-3-2d2":["/metadata---docs-f-2-e-test-jestda-3-2d2.adab61b10dc884940697.js"],"content---docs-f-2-e-vue-index-02-b-a5c":["/content---docs-f-2-e-vue-index-02-b-a5c.1a89ee7799561a11c838.js"],"metadata---docs-f-2-e-vue-indexefd-70b":["/metadata---docs-f-2-e-vue-indexefd-70b.cf1da06406c97aa9fa7e.js"],"content---docs-f-2-e-vue-origind-8-a-797":["/content---docs-f-2-e-vue-origind-8-a-797.d2a1c92c815111e5ae49.js"],"metadata---docs-f-2-e-vue-origin-587-f6e":["/metadata---docs-f-2-e-vue-origin-587-f6e.e813ff92cd5be1db3996.js"],"content---docs-f-2-e-vue-zf-6-bb-fd6":["/content---docs-f-2-e-vue-zf-6-bb-fd6.692f41b8d417fafc6e9b.js"],"metadata---docs-f-2-e-vue-zf-258-73c":["/metadata---docs-f-2-e-vue-zf-258-73c.20ff3796deb4b2fd5507.js"],"content---docs-source-jquery-event-088-dda":["/content---docs-source-jquery-event-088-dda.f6e5868415ea4e65585a.js"],"metadata---docs-source-jquery-event-095-2e1":["/metadata---docs-source-jquery-event-095-2e1.1c699411bca0b71a279d.js"],"content---docs-f-2-e-webpack-basic-indexb-92-061":["/content---docs-f-2-e-webpack-basic-indexb-92-061.a356aab10b36725975a9.js"],"metadata---docs-f-2-e-webpack-basic-indexe-25-12c":["/metadata---docs-f-2-e-webpack-basic-indexe-25-12c.bc97bc27a12dd1743d78.js"],"content---docs-f-2-e-webpack-principle-indexab-1-27c":["/content---docs-f-2-e-webpack-principle-indexab-1-27c.72e6a91cc91a1c9ba7fb.js"],"metadata---docs-f-2-e-webpack-principle-index-6-fa-123":["/metadata---docs-f-2-e-webpack-principle-index-6-fa-123.6036461c39812f0a9a54.js"],"component---theme-blog-tags-posts-page-687-b6c":["/component---theme-blog-tags-posts-page-687-b6c.cdc359f6a4d913ae5117.js"],"metadata---blog-tags-house-375-d32":["/metadata---blog-tags-house-375-d32.e20a6720ecb0953ce25d.js"],"metadata---blog-tags-thinkd-55-455":["/metadata---blog-tags-thinkd-55-455.465f7f9506ae524a47b1.js"],"component---theme-blog-tags-list-page-01-a-d0b":["/component---theme-blog-tags-list-page-01-a-d0b.c1d0294e65cf51f7434b.js"],"tags---blog-tagse-51-a7c":["/tags---blog-tagse-51-a7c.90fa7a1570bf6531abb5.js"]};/*]]>*/</script>

<title data-react-helmet="true">网络请求</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="网络请求"/><meta data-react-helmet="true" name="description" content="&lt;!-- ![](/img/fetch/1.svg) --&gt;"/><meta data-react-helmet="true" property="og:description" content="&lt;!-- ![](/img/fetch/1.svg) --&gt;"/><meta data-react-helmet="true" property="og:url" content="https://www.banli17.com/docs/f2e/browser/fetch"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.d719e73e126f22665d27.css" />

<link rel="stylesheet" type="text/css" href="/1.196ce05925ea6d776920.css" />

<link rel="stylesheet" type="text/css" href="/2.76ced7e22babc8d30c3a.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-page-9-e-7-ca5.3c38a2f40a51efdd72a0.css" />

<link rel="stylesheet" type="text/css" href="/3.76fc2d47232fd1193413.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-item-031-769.2f2552f02b6a918fee59.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="板栗17的博客"/><strong>banli17.com</strong></a><a class="navbar__item navbar__link" label="前端" position="left" href="/docs/f2e/html/index">前端</a><a class="navbar__item navbar__link" label="源码笔记" position="left" href="/docs/source/jquery/event">源码笔记</a><a class="navbar__item navbar__link" label="NodeJS" position="left" href="/docs/nodejs/util">NodeJS</a><a class="navbar__item navbar__link" label="设计模式" position="left" href="/docs/patterns/index">设计模式</a><a class="navbar__item navbar__link" label="算法" position="left" href="/docs/algo/index">算法</a><a class="navbar__item navbar__link" label="服务器" position="left" href="/docs/linux/index">服务器</a><a class="navbar__item navbar__link" label="计算机基础" position="left" href="/docs/base/h5">计算机基础</a><a class="navbar__item navbar__link" label="工具" position="left" href="/docs/other/mac">工具</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" label="博客" position="right" href="/blog">博客</a><a class="navbar__item navbar__link" label="关于" position="right" href="/docs/about">关于</a><a class="navbar__item navbar__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="板栗17的博客"/><strong>banli17.com</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="前端" position="left" href="/docs/f2e/html/index">前端</a></li><li class="menu__list-item"><a class="menu__link" label="源码笔记" position="left" href="/docs/source/jquery/event">源码笔记</a></li><li class="menu__list-item"><a class="menu__link" label="NodeJS" position="left" href="/docs/nodejs/util">NodeJS</a></li><li class="menu__list-item"><a class="menu__link" label="设计模式" position="left" href="/docs/patterns/index">设计模式</a></li><li class="menu__list-item"><a class="menu__link" label="算法" position="left" href="/docs/algo/index">算法</a></li><li class="menu__list-item"><a class="menu__link" label="服务器" position="left" href="/docs/linux/index">服务器</a></li><li class="menu__list-item"><a class="menu__link" label="计算机基础" position="left" href="/docs/base/h5">计算机基础</a></li><li class="menu__list-item"><a class="menu__link" label="工具" position="left" href="/docs/other/mac">工具</a></li><li class="menu__list-item"><a class="menu__link" label="博客" position="right" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" label="关于" position="right" href="/docs/about">关于</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></div></div></nav><div class="container container--fluid"><div class="row"><div class="col col--3"><div class="sidebar_Qb2S"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1uhT" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Html</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/html/index">HTML</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Css</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/css/index">css基础</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/grammer">语法</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/type">数据类型</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/oop">面向对象</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/module">模块化编程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/async">异步编程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/regexp">正则表达式</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/skill">高级技巧</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">浏览器原理与API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/dom">DOM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/work">现代浏览器工作原理(翻译)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/eventloop">事件循环</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/event">事件机制</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/f2e/browser/fetch">网络请求与表单</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/storage">浏览器存储</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/devtool">Chrome 开发者工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/cache">浏览器缓存机制</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/v8">V8 引擎原理</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">其它</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/monitor/index">前端监控</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/test/index">前端测试与jest</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/safe/index">web 安全</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/performance/index">网站性能优化</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/webpack/basic/index">webpack (1): 官方文档总结</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/webpack/principle/index">webpack (2): 原理</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/react/index">React 知识点总结</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">vue</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/vue/index">知识点总结</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/vue/origin">原理分析</a></li></ul></li></ul></div></div></div><main class="col"><div><div class="padding-vert--lg"><div class="row"><div class="col"><div class="docItemContainer_1VCq"><header><h1 class="margin-bottom--lg">网络请求</h1></header><article><div class="markdown"><h2><a aria-hidden="true" class="anchor" id="简介"></a><a aria-hidden="true" class="hash-link" href="#简介">#</a>简介</h2><h2><a aria-hidden="true" class="anchor" id="xmlhttprequest-对象"></a><a aria-hidden="true" class="hash-link" href="#xmlhttprequest-对象">#</a>XMLHttpRequest 对象</h2><ol><li><p>简述ajax，及其代码流程？
ajax就是利用XMLHttpRequest对象向后端发送请求，返回数据并处理的技术，整个过程无需刷新页面。
代码流程如下：创建ajax对象 -&gt; open() -&gt; 监听事件，readyState为4，且响应码是2开头或304 -&gt; send() 发送请求。</p></li><li><p>ajax对象的属性</p><ul><li>说说readyState的几种状态，分别是什么意思?
0: 请求还没有初始化，open之前
1: 建立连接，open后
2: 请求已接受,send后
3: 正在处理请求
4: 请求已完成，且响应已准备好</li><li>response是什么，类型可以是哪些，怎么设置类型？</li><li>responseType的作用？</li><li>responseText属性是什么？服务器以文本字符的形式返回</li><li>responseXML属性是什么？以 XMLDocument 对象方式返回</li><li>常用的status有哪些，分别是什么意思?</li><li>statusText和status的区别？</li><li>timeout的作用?</li></ul></li><li><p>ajax对象的方法</p><ul><li>open()：说说它的参数?
open的第一个参数是请求方法，注意要大写，否则有些浏览器无法处理请求。如果是同步，不必使用函数，不过不推荐，体验不好，而且Firefox 30.0已经废弃同步请求。最好在回调里使用try...catch，因为通信错误（如果服务器宕机）会抛出错误。</li><li>overrideMimeType()和responseType</li><li>发送和接收二进制数据</li></ul></li><li><p>ajax的事件有哪些？(8个)</p></li><li><p>withCredentials是什么，怎么用?</p></li><li><p>怎么获取服务器所有响应头信息和某字段头信息？所有头信息的格式？如果头信息字段重名会怎么样？</p></li><li><p>http请求方式有哪些，get和post的区别?</p></li><li><p>send()的参数类型有哪些?</p></li><li><p>setRequestHeader() 什么时候用?如果多次设置同一字段这个字段的值是什么?怎么解决post乱码问题?</p></li><li><p>怎么通过overrideMimeType()接受二进制数据？接受二进制数据更好的方式是什么？</p></li><li><p>form表单提交的四种格式，以及数据在浏览器面板里的样子?</p></li><li><p>什么是同源策略</p></li><li><p>跨域的不同窗口通信解决方案有哪些，分别的原理，实战？优缺点？</p></li><li><p>什么是同源？非同源什么会限制？每种限制分别的解决方法？（考虑完全不同源的情况）</p></li><li><p>window.postMessage怎么用？通过它读写其它窗口的localStorage。</p></li><li><p>ajax跨域的解决方案和原理？各种方案的优点和缺点？</p></li></ol><h2><a aria-hidden="true" class="anchor" id="表单提交"></a><a aria-hidden="true" class="hash-link" href="#表单提交">#</a>表单提交</h2><h2><a aria-hidden="true" class="anchor" id="同源政策"></a><a aria-hidden="true" class="hash-link" href="#同源政策">#</a>同源政策</h2><p>同源是指协议、端口、域名都相同。如果有一个不同，浏览器将会在某些方法做一些限制。具体限制的地方有：</p><ol><li>本地数据无法获取：cookie、localStorage、indexedDB。</li><li>dom无法获取。</li><li>ajax请求无效，可以发送，但是浏览器拒绝响应。</li></ol><blockquote><p>为什么浏览器要使用同源策略呢？</p></blockquote><p>同源策略的目的，是为了保证用户信息的安全，防止恶意网站窃取数据。</p><p>比如如果没有同源限制，恶意网站 B 网站可以嵌套 iframe 来获取 A 网站的 Cookie，得到 Cookie 后，攻击者往往就可以直接登录了。</p><blockquote><p>为什么表单提交没有同源策略限制呢？</p></blockquote><p>因为同源策略是为了阻止攻击者获取用户信息，Ajax 可以获取响应，浏览器认为这不安全，所以拦截了响应。但是表单提交并不会获取内容，所以可以跨域发起。同时这也说明跨域并不能阻止 CSRF 攻击，因为请求已经发出了。</p><h2><a aria-hidden="true" class="anchor" id="跨域的解决方案"></a><a aria-hidden="true" class="hash-link" href="#跨域的解决方案">#</a>跨域的解决方案</h2><p>跨域的解决方法有很多: </p><ul><li>jsonp</li><li>cors</li><li>postMessage</li><li>document.domain</li><li>window.name</li><li>location.hash</li><li>http-proxy</li><li>nginx</li><li>websocket</li></ul><p>虽然有这么多方法，但是线上项目一般使用<code>jsonp</code>和<code>cors</code>来解决跨域。</p><h3><a aria-hidden="true" class="anchor" id="jsonp"></a><a aria-hidden="true" class="hash-link" href="#jsonp">#</a>jsonp</h3><p>html 文档中的<code>&lt;img&gt;</code>和<code>&lt;script&gt;</code>标签不受同源策略限制，通过它们可以获取其它网站的资源。通过这个特点，可以实现跨域，具体如下：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-html codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">// 1. 先定义一个全局jsonp() 函数</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#d6deeb"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:rgb(127, 219, 202)">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:rgb(130, 170, 255)">jsonp</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token script language-javascript parameter">data</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#d6deeb"><span class="token script language-javascript">        </span><span class="token script language-javascript comment" style="color:rgb(99, 119, 119);font-style:italic">// do... </span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#d6deeb"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#d6deeb"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// 2. 获取跨域js脚本，接口返回 jsonp({name:&#x27;zs&#x27;})，会执行上面的 jsonp 函数</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(127, 219, 202)">script</span><span class="token tag" style="color:rgb(127, 219, 202)"> </span><span class="token tag attr-name" style="color:rgb(173, 219, 103);font-style:italic">src</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag attr-value" style="color:rgb(127, 219, 202)">b.com/getUser?callback=jsonp</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&#x27;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(127, 219, 202)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面代码中，我们先定义好一个<code>jsonp()</code>方法(随便什么名字，要和后端约定好，或者通过 get 参数<code>callback=jsonp</code>传给后端)，然后请求其它网站的接口如 getUser(script标签会默认解析为js)。getUser接口会返回代码<code>jsonp({name:&#x27;zs&#x27;})</code>会被执行。所以也就执行了我们预先定义好的 jsonp 方法里的逻辑。</p><p>简单实现一个 jsonp 方法。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">jsonp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">opt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> opt</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> script </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">createElementS</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">jsonp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;b.com/b.js&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;show&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>采用jsonp的方法实现跨域，它的优点是：</p><ul><li>浏览器都兼容</li><li>数据直接是对象，不需要解析</li></ul><p>缺点是：</p><ul><li>只能发 get 请求，不支持 post。</li><li>url 有长度限制。</li><li>不安全，可能别人的 js 文件里可能有攻击代码 xss。</li></ul><h3><a aria-hidden="true" class="anchor" id="cors"></a><a aria-hidden="true" class="hash-link" href="#cors">#</a>CORS</h3><p><code>CORS</code>全称是<code>cross-origin resource sharing</code>，目的是解决跨域的问题。它需要前后端都支持，IE 8 和 9 需要通过 XDomainRequest 来实现。</p><p>对于服务端来说，需要设置 header 的<code>Access-Control-Allow-Origin</code>。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 写*不能携带cookie</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Allow-Origin&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://localhost:63342&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 如果是非简单请求，则会先发 OPTIONS 预检，看服务器是否支持这个方法、是否支持自定义的头</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Allow-Methods&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;PUT&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Allow-Headers&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;a&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 前端a必须要有，否则报错</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 跨域默认情况下，前端 xhr 对象只能拿到一些最基本的响应头，如果要访问其它头，需要设置</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Expose-Headers&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;a&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 预检请求的有效期，在这么多秒内，不再发预检</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Max-Age&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;1&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">method</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;OPTIONS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">statusCode</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">200</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ok&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>CORS 将根据简单请求和非简单请求，会增加一些设置。</p><p>简单请求的要求是：</p><ol><li>请求方法是 GET、HEAD、POST 中的一个。</li><li>Content-Type 的值是<code>text/plain</code>、<code>multipart/form-data</code>、<code>application/x-www-form-urlencoded</code>中的一个。</li><li>XMLHttpRequestUpload 对象没有注册任何事件监听器，XMLHttpRequestUpload 对象可以使用 XMLHttpRequest.upload 属性访问。</li><li>请求中没有使用 ReadableStream 对象。</li><li>不能人为设置 Accept、Accept-Language、Content-Language 、Content-Type。</li></ol><p>与简单请求相反的就是非简单请求。非简单请求将首先发送预检 OPTIONS 请求，来查看服务器是否支持跨域请求。</p><p>默认情况下，跨域是不发送 Cookie 的，可以设置<code>xhr.withCredentials = true</code>以支持。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">cookie</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;name=zs&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">xhr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">withCredentials</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Allow-Credentials&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// unsafe headers 允许前端获取哪个头</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setHeader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;Access-Control-Expose-Headers&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;name&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="postmessage"></a><a aria-hidden="true" class="hash-link" href="#postmessage">#</a>postMessage</h3><p>html5 引入了<code>window.postMessage</code>。允许跨窗口通信，不论这两个窗口是否同源。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">postMessage(msg, origin)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>postMessage方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源（origin），即“协议 + 域名 + 端口”。也可以设为*，表示不限制域名，向所有窗口发送。</p><p>父窗口和子窗口都可以通过message事件，监听对方的消息。</p><p><strong>a.html</strong></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// a.html</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">iframe src</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;http://localhost:4000/b.html&quot;</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;frame&#x27;</span><span class="token plain"> frameborder</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;0&quot;</span><span class="token plain"> onload</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;load()&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">iframe</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">load</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> frame </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getElementById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;frame&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        frame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">contentWindow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">postMessage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://localhost:4000&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// window.onmessage = (e) =&gt; {</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//     console.log(e.data)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// }</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>localhost:4000/b.html</strong></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">onmessage</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;b&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// e.source.postMessage(&#x27;收到了&#x27;)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>事件对象的常用属性如下：</p><ul><li><code>event.source</code>：发送消息的窗口</li><li><code>event.origin</code>: 消息发向的网址，可以通过它过滤不是发给本窗口的消息。</li><li><code>event.data</code>: 消息内容</li></ul><h3><a aria-hidden="true" class="anchor" id="windowname"></a><a aria-hidden="true" class="hash-link" href="#windowname">#</a>window.name</h3><h3><a aria-hidden="true" class="anchor" id="hash"></a><a aria-hidden="true" class="hash-link" href="#hash">#</a>hash</h3><p>就是通过父窗口改变子窗口的hash，然后子窗口监听到hash变化，拿到数据。同理子窗口也可以改变父窗口hash。主要用于 iframe。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// a.com</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">button </span><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;btn&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain">点击</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">button</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">iframe src</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;http://www.b.com/index.html&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">iframe</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">querySelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;.btn&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">onclick</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">querySelector</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;iframe&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;#&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello=1&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// b.com</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">onhashchange</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hash change&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">hash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="documentdomain"></a><a aria-hidden="true" class="hash-link" href="#documentdomain">#</a>document.domain</h3><p><code>document.domain</code>方法只适合 iframe 下子窗口读取父窗口的 cookie。</p><h3><a aria-hidden="true" class="anchor" id="websocket"></a><a aria-hidden="true" class="hash-link" href="#websocket">#</a>websocket</h3><p>http缺陷：只能客户端发请求。 如果要更新，需要轮询。效率低，浪费资源。</p><p>websocket 是 tcp协议，没有跨域问题</p><ul><li><a href="http://javascript.ruanyifeng.com/htmlapi/websocket.html">http://javascript.ruanyifeng.com/htmlapi/websocket.html</a></li><li><a href="https://www.zhihu.com/question/20215561">https://www.zhihu.com/question/20215561</a></li></ul><h2><a aria-hidden="true" class="anchor" id="图片上传"></a><a aria-hidden="true" class="hash-link" href="#图片上传">#</a>图片上传</h2><p>图片上传是一个很常见的需求，常见的处理方法有下面几种：</p><p>1、传统的表单提交
2、ajax + ReadFile() 将图片转成 base64 格式数据
3、ajax + FormData() 还是通过原始图片格式上传
4、百度 webUploader 图片上传插件 </p><h3><a aria-hidden="true" class="anchor" id="传统的file-input"></a><a aria-hidden="true" class="hash-link" href="#传统的file-input">#</a>传统的file input</h3><p>通过 form type=file 的方法提交。</p><h3><a aria-hidden="true" class="anchor" id="ajax--readfile"></a><a aria-hidden="true" class="hash-link" href="#ajax--readfile">#</a>ajax + ReadFile()</h3><p>将图片转成 base64 格式数据</p><h3><a aria-hidden="true" class="anchor" id="ajax--formdata"></a><a aria-hidden="true" class="hash-link" href="#ajax--formdata">#</a>ajax + FormData()</h3><p>html5 提供了一个 FormData类，它可以将表单数据序列化（包括图片），和ajax联合使用，这样页面就不会跳转，用户体验也很好。这个和传统表单提交时发送的图片格式是一样的。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;form id=&quot;uploadForm&quot;&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    &lt;input class=&quot;weui-uploader__input&quot; type=&quot;file&quot; accept=&quot;image/*&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">           multiple=&quot;&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">           name=&quot;file&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">           @change=&quot;uploadImage&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    &gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/form&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">$.ajax({</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    type: &#x27;post&#x27;,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    url: this.state_api.common.uploadImg,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    data: new FormData(document.getElementById(&#x27;uploadForm&#x27;)),</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    contentType: false,   // 必须</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    processData: false,   // 必须</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    async: false,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    cache: false,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    dataType: &quot;json&quot;,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    success: function (data) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        _this.images.push(data.data)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">});</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="遇到的一些坑"></a><a aria-hidden="true" class="hash-link" href="#遇到的一些坑">#</a>遇到的一些坑</h2><p>1、使用 thinkphp 做为后台，在移动端上传图片时，提示&quot;文件类型不符合要求&quot;。</p><p>这是由于 thinkphp 后端判断图片类型时是判断的文件后缀，而不是根据文件的前几个字节来判断类型的。需要修改。</p><p>2、移动端有的手机点击 input type=&#x27;file&#x27;按钮没反应。此问题还没有解决。</p><p>需要安卓修改 webview。</p><h2><a aria-hidden="true" class="anchor" id="mime-类型"></a><a aria-hidden="true" class="hash-link" href="#mime-类型">#</a>mime 类型</h2><p>浏览器通常使用mime类型(而不是文件扩展名)来确定如何处理文件，对于未知的类型，浏览器会以附件的形式(下载)处理。因此服务器设置正确 mime 类型很重要。</p><p>比如<code>&lt;link type=&quot;text/plain&quot; href=&#x27;1.css&#x27; /&gt;</code>，浏览器并不能解析 1.css。</p><p>mime类型的语法是<code>type/subtype</code>。由类型和子类型组成。大小写不敏感，通常小写。它分为独立类型和 multipart 类型。</p><p><strong>独立类型</strong></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">text/plain   // 未知的文本类型</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">text/html</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">image/jpeg</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">image/png</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">audio/mpeg</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">audio/ogg</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">audio/*</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">video/mp4</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">application/octet-stream  // 未知的二进制类型</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>multipart 类型</strong></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">multipart/form-data</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">multipart/byteranges</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="applicationoctet-stream"></a><a aria-hidden="true" class="hash-link" href="#applicationoctet-stream">#</a>application/octet-stream</h3><p>这是应用程序文件的默认值。意思是 未知的应用程序文件 ，浏览器一般不会自动执行或询问执行。浏览器会像对待 设置了HTTP头Content-Disposition 值为“附件”的文件一样来对待这类文件。</p><h3><a aria-hidden="true" class="anchor" id="textplain"></a><a aria-hidden="true" class="hash-link" href="#textplain">#</a>text/plain</h3><p>文本文件默认值。意思是 未知的文本文件 ，浏览器认为是可以直接展示的。但是比如<code>&lt;link&gt;</code>里类型如果是<code>text/plain</code>，浏览器不会将它解析成css文件，除非是<code>text/css</code>。</p><h3><a aria-hidden="true" class="anchor" id="textcss"></a><a aria-hidden="true" class="hash-link" href="#textcss">#</a>text/css</h3><p>注意服务器经常不会分辨使用.css后缀的css文件，并将其mime类型设置为text/plain 或 application/octet-stream 发送。这样浏览器就不能解析了。</p><h3><a aria-hidden="true" class="anchor" id="texthtml"></a><a aria-hidden="true" class="hash-link" href="#texthtml">#</a>text/html</h3><p>所有的html文件都需要使用这种类型。</p><h3><a aria-hidden="true" class="anchor" id="图片类型"></a><a aria-hidden="true" class="hash-link" href="#图片类型">#</a>图片类型</h3><p><code>image/gif</code>， <code>image/jpeg</code>， <code>image/png</code>, <code>image/svg+xml</code>。有最新的<code>image/webp</code>类型，但是增加新类型不但会增加代码，而且可能带来安全问题。所以浏览器供应商十分小心。另外还有<code>image/x-icon</code>类型，比如favicons。</p><h3><a aria-hidden="true" class="anchor" id="音频和视频类型"></a><a aria-hidden="true" class="hash-link" href="#音频和视频类型">#</a>音频和视频类型</h3><h3><a aria-hidden="true" class="anchor" id="multipartform-data"></a><a aria-hidden="true" class="hash-link" href="#multipartform-data">#</a>multipart/form-data</h3><p><code>multipart/form-data</code>可以用于html表单从浏览器发送数据给服务器。它由边界线(--开头的字符串)划分不同部分组成。每个部分都有自己的实体、http请求头、Content-Disposition和 Content-Type 用于文件上传领域，最常用的 (Content-Length 因为边界线作为分隔符而被忽略）。</p><h3><a aria-hidden="true" class="anchor" id="mime-嗅探"></a><a aria-hidden="true" class="hash-link" href="#mime-嗅探">#</a>MIME 嗅探</h3><p>可以使用浏览器可以通过请求头 Content-Type 来设置 X-Content-Type-Options 以阻止 MIME 嗅探。</p><h3><a aria-hidden="true" class="anchor" id="其他检查文件类型的方法"></a><a aria-hidden="true" class="hash-link" href="#其他检查文件类型的方法">#</a>其他检查文件类型的方法</h3><p>除了mime类型，还有其它绝对文件类型的方法：如后缀和文件标志，比如47 49 46 38十六进制值<!-- -->[GIF89]<!-- -->或89 50 4E 47 <!-- -->[.PNG]<!-- -->的PNG文件开头。但是都不可靠。</p><h2><a aria-hidden="true" class="anchor" id="面试题"></a><a aria-hidden="true" class="hash-link" href="#面试题">#</a>面试题</h2><ol><li>对跨域的了解?</li><li>跨域怎么解决，有没有使用过Apache等方案?</li><li>文件上传如何做断点续传?</li><li>表单可以跨域吗?</li><li>通过什么做到并发请求?</li><li>介绍service worker?</li><li>前后端通信使用什么方案?</li><li>RESTful常用的Method?</li><li>介绍下跨域?</li><li>如何解决跨域问题?</li><li>ajax如何处理跨域?</li><li>CORS如何设置?</li><li>jsonp为什么不支持post方法?</li><li>介绍同源策略?</li><li>Access-Control-Allow-Origin在服务端哪里配置?</li><li>Ajax发生跨域要设置什么（前端）?</li><li>加上CORS之后从发起到请求正式成功的过程?</li><li>异步请求，低版本fetch如何低版本适配?</li><li>get 和 post 有什么区别?</li><li>jsonp方案需要服务端怎么配合?</li><li>formData和原生的ajax有什么区别?</li><li>介绍下表单提交，和formData有什么关系?</li><li>服务端怎么做统一的状态处理?</li></ol><ul><li>写一个简单的<code>ajax</code>库。</li><li>学习<code>zepto</code>的<code>ajax</code>源代码。</li><li><code>$.Deferred</code>的实现，再看看Promise。</li><li>通过两种方式<code>FormData</code>和<code>file api</code>分别实战文件上传？</li></ul><h2><a aria-hidden="true" class="anchor" id="参考资料"></a><a aria-hidden="true" class="hash-link" href="#参考资料">#</a>参考资料</h2><ul><li>极客时间：趣谈网络协议</li><li><a href="http://javascript.ruanyifeng.com/bom/ajax.html">http://javascript.ruanyifeng.com/bom/ajax.html</a></li><li><a href="http://javascript.ruanyifeng.com/bom/same-origin.html">http://javascript.ruanyifeng.com/bom/same-origin.html</a></li><li><a href="http://javascript.ruanyifeng.com/bom/cors.html">http://javascript.ruanyifeng.com/bom/cors.html</a></li><li><a href="http://javascript.ruanyifeng.com/htmlapi/websocket.html">http://javascript.ruanyifeng.com/htmlapi/websocket.html</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX">https://developer.mozilla.org/zh-CN/docs/Web/Guide/AJAX</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html">浏览器同源政策及其规避方法</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/04/cors.html">跨域资源共享 CORS 详解</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME类型</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Disposition">Content-Disposition</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type">Content-Type</a></li><li><a href="https://github.com/madrobby/zepto">zepto源码</a></li><li><a href="http://javascript.ruanyifeng.com/bom/cors.html">CORS通信</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS#">HTTP访问控制（CORS）</a></li><li><a href="http://javascript.ruanyifeng.com/bom/same-origin.html">http://javascript.ruanyifeng.com/bom/same-origin.html</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">浏览器的同源策略</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/CORS_enabled_image">启用了 CORS 的图片</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage">window.postMessage</a></li></ul><p>XMLHttpRequest有2种方式提交表单：</p><ul><li>使用ajax：复杂但是灵活</li><li>使用FormData：简单但是无法将数据用JSON.stringify()转成json字符串。</li></ul><h2><a aria-hidden="true" class="anchor" id="使用ajax"></a><a aria-hidden="true" class="hash-link" href="#使用ajax">#</a>使用ajax</h2><p>一般的表单，如果不用FormData，也不会用其它的API，除非要上传文件，需要使用FileReader。</p><p><code>&lt;form&gt;</code>可以用下面四种方式发送：
1. post，且enctype是application/x-www-form-urlencoded（默认）
1. post，且enctype是text/plain
1. post，且enctype是multipart/form-data
1. get</p><p>如果一个表单有2个字段foo和baz，那么上面对应的编码数据分别是：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">// Content-Type: application/x-www-form-urlencoded</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">foo=bar&amp;baz=The+first+line.&amp;#37;0D%0AThe+second+line.%0D%0A</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// Content-Type: text/plain</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">foo=bar</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">baz=The first line.</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">The second line.</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// Content-Type: multipart/form-data; boundary=---------------------------314911788813839</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">-----------------------------314911788813839</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Content-Disposition: form-data; name=&quot;foo&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">bar</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">-----------------------------314911788813839</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">Content-Disposition: form-data; name=&quot;baz&quot;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">The first line.</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">The second line.</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">-----------------------------314911788813839--</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// get</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">?foo=bar&amp;baz=The%20first%20line.%0AThe%20second%20line.</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面的转码都是在提交form时浏览器自动完成。但是如果要用ajax来实现，就需要自己实现。具体实现代码如下：</p><ol><li><code>input=button</code>不会提交表单</li><li>input没有name属性，这个字段不会提交</li></ol><h2><a aria-hidden="true" class="anchor" id="formdata"></a><a aria-hidden="true" class="hash-link" href="#formdata">#</a>FormData</h2><p>使用FormData提交表单十分简单，它和<code>&lt;form enctype=&quot;multipart/form-data&quot;&gt;</code>提交的数据格式是一样的，而且可以上传文件。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; name=&quot;fileinfo&quot;&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;label&gt;Your email address:&lt;/label&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;input type=&quot;email&quot; autocomplete=&quot;on&quot; autofocus name=&quot;userid&quot; placeholder=&quot;email&quot; required size=&quot;32&quot; maxlength=&quot;64&quot; /&gt;&lt;br /&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;label&gt;Custom file label:&lt;/label&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;input type=&quot;text&quot; name=&quot;filelabel&quot; size=&quot;12&quot; maxlength=&quot;32&quot; /&gt;&lt;br /&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;label&gt;File to stash:&lt;/label&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;input type=&quot;file&quot; name=&quot;file&quot; required /&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  &lt;input type=&quot;submit&quot; value=&quot;Stash the file!&quot; /&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/form&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;div&gt;&lt;/div&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">var form = document.forms.namedItem(&quot;fileinfo&quot;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">form.addEventListener(&#x27;submit&#x27;, function(ev) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  var oOutput = document.querySelector(&quot;div&quot;),</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      oData = new FormData(form);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  oData.append(&quot;CustomField&quot;, &quot;This is some extra data&quot;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  var oReq = new XMLHttpRequest();</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  oReq.open(&quot;POST&quot;, &quot;stash.php&quot;, true);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  oReq.onload = function(oEvent) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    if (oReq.status == 200) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      oOutput.innerHTML = &quot;Uploaded!&quot;;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      oOutput.innerHTML = &quot;Error &quot; + oReq.status + &quot; occurred when trying to upload your file.&lt;br \/&gt;&quot;;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  };</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  oReq.send(oData);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  ev.preventDefault();</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">}, false);</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面的代码会自动将form表单的数据生成FormData，然后发送。</p><p>下面是FormData API的详细介绍。</p><h3><a aria-hidden="true" class="anchor" id="formdata-api"></a><a aria-hidden="true" class="hash-link" href="#formdata-api">#</a>FormData API</h3><p><strong>append()</strong></p><p>append()方法可以追加要传给后台的表单字段。语法是：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">append(name, value)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">append(name, value, filename)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>name是表单的字段名。value是值，还可以是File或Blob类型。如果是File或Blob类型，则可以指定其文件名。Blob的默认文件名是&#x27;blob&#x27;。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;name&#x27;, &#x27;张三&#x27;)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;age&#x27;, 12) // 12会转为&#x27;12&#x27;,非file或blob类型会转成字符串</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;pic[]&#x27;, f.files[0], &#x27;1.jpg&#x27;)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>delete()</strong></p><p>可以删除指定的键值对，参数是要删除的 Key 的名字。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.delete(&#x27;age&#x27;)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>entries()</strong></p><p>返回iterator对象，可以遍历FormData中的键值对。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var formData = new FormData();</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;key1&#x27;, &#x27;value1&#x27;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;key2&#x27;, &#x27;value2&#x27;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">for(var pair of formData.entries()) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">   console.log(pair[0]+ &#x27;, &#x27;+ pair[1]); </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">}</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// 执行结果</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">key1, value1</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">key2, value2</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>get()</strong></p><p>用于获取某个键的第一个值。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.append(&#x27;name&#x27;, &#x27;李四&#x27;)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.get(&#x27;name&#x27;); // &quot;张三&quot;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>getAll()</strong></p><p>获取某个键的所有的值。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.getAll(&#x27;name&#x27;) // [&#x27;张三&#x27;,&#x27;李四&#x27;]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>has()</strong>
<strong>keys()</strong>
<strong>set()</strong></p><p>用于修改值，如果不存在，则添加。而append()是在该key最后追加一个值。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.set(&#x27;username&#x27;, &#x27;Chris&#x27;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">formData.set(&#x27;userpic&#x27;, myFileInput.files[0], &#x27;chris.jpg&#x27;);</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="jquery里使用formdata"></a><a aria-hidden="true" class="hash-link" href="#jquery里使用formdata">#</a>jQuery里使用FormData</h3><p>在<code>jquery</code>里使用<code>FormData</code>需要注意设置<code>processData</code>和<code>contentType</code>为<code>false</code>。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var fd = new FormData(document.querySelector(&quot;form&quot;));</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">fd.append(&quot;CustomField&quot;, &quot;This is some extra data&quot;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">$.ajax({</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  url: &quot;stash.php&quot;,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  type: &quot;POST&quot;,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  data: fd,</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  processData: false,  // 不处理数据</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  contentType: false   // 不设置内容类型</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">});</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>values()</strong></p><p>和entries()类似。</p><h2><a aria-hidden="true" class="anchor" id="参考资料-1"></a><a aria-hidden="true" class="hash-link" href="#参考资料-1">#</a>参考资料</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData/Using_FormData_Objects">FormData 对象的使用</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FormData">FormData API</a></li></ul><h1><a aria-hidden="true" class="anchor" id="提交表单和上传文件---总结"></a><a aria-hidden="true" class="hash-link" href="#提交表单和上传文件---总结">#</a>提交表单和上传文件 - 总结</h1><ol><li><p><code>html &lt;form&gt;</code>提交表单的四种方式？</p></li><li><p>根据上面的方式写一个ajax提交表单库。包含文件上传。</p></li><li><p>描述FormData</p></li><li><p>描述文件API，File和FileReader。</p></li><li><p>上传进度。</p></li></ol><p>html5为我们提供了读取文件内容的接口，这样为我们的开发提供了一些遍历，比如文件上传时可以轻松的显示缩略图。获取上传文件的大小等等。</p><p>和文件相关的API有Blob、File、FileReader。</p><p><strong>目录：</strong></p><ul><li><a href="#Blob">Blob</a></li><li><a href="#File">File</a></li><li><a href="#FileReader">FileReader</a></li></ul><h2><a aria-hidden="true" class="anchor" id="blob"></a><a aria-hidden="true" class="hash-link" href="#blob">#</a>Blob</h2><p>Blob全称是<code>binary large object</code>，即二进制大型文件，可以存二进制的容器。Blob通常是视频、声音或多媒体文件。js里的Blob是一个底层API，文件就是基于它的。</p><ol><li>创建Blob对象</li></ol><p>要从其它非Blob对象和数据创建一个Blob，需要使用Blob()构造函数。 语法是：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var blob = new Blob(array, options)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><code>array</code>是一个由<code>ArrayBuffer</code>, <code>ArrayBufferView</code>, <code>Blob</code>, <code>DOMString</code> 等对象构成的 <code>Array</code>，或者其他类似对象的混合体，它将会被放进 Blob。DOMStrings会被编码为UTF-8。</p><p><code>options</code>有两个属性，<code>type</code>默认是<code>&quot;&quot;</code>，表示放入<code>blob</code>中的数组内容的mime类型。<code>endings</code>，表示结束符\n如何被写入。默认是<code>transparent</code>，表示结束符不变，<code>native</code>表示更改为适合操作系统的换行符。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var debug = {hello: &quot;world&quot;};</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">var blob = new Blob([JSON.stringify(debug, null, 2)],</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  {type : &#x27;application/json&#x27;});</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">console.log(blob.size)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">console.log(blob.type)  // &#x27;application/json&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>获取blob的尺寸，使用size属性。获取mime类型，使用type属性，如果类型未知，则为空字符串。</p><p>2.要创建一个包含子Blob对象的Blob，可以使用slice()</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var blob = instanceOfBlob.slice([start [, end [, contentType]]]};</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>start表示Blob里的开始下标。end如果是负数，则是倒数第几个字节。contentType默认是空字符串，表示给新Blob设置的文档类型。</p><ol start="3"><li>读取blob信息</li></ol><p>获取用户系统上的文件Blob对象，要使用File API。从Blob中读取内容的唯一方式是使用FileReader。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var reader = new FileReader();</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">reader.addEventListener(&quot;loadend&quot;, function() {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">   // reader.result 包含转化为类型数组的blob</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">});</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">reader.readAsText(blob);</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="file"></a><a aria-hidden="true" class="hash-link" href="#file">#</a>File</h2><p>元素<code>&lt;input type=&#x27;file&#x27;&gt;</code>在选择图片后，它的files属性会返回选择图片的相关信息。</p><p><img src="./_img/files.png" alt="files"/></p><p>可以看到，它是一个FileList对象，是一个类数组，由多个File对象组成。File对象是一种特殊的Blob，可以通过FileReader，URL.createObjectURL()，createImageBitmap()及XMLHttpRequest.send()处理Blob和File。</p><p>从上图可以知道，file对象的一些属性：</p><ul><li>File.lastModified：只读，返回文件最后修改时间，自1970年1月1日0:00的毫秒数</li><li>File.lastModifiedDate：只读，返回最后修改的Date对象</li><li>File.name：返回文件的名字</li><li>File.size：返回文件的大小，单位是Byte</li><li>File.type：返回文件的mime类型</li><li>File.webkitRelativePath：这是个chrome下私有属性，结合下面代码了解。</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;input type=&quot;file&quot; id=&quot;filepicker&quot; name=&quot;fileList&quot; webkitdirectory multiple/&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;ul id=&quot;listing&quot;&gt;&lt;/ul&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;script&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    document.getElementById(&quot;filepicker&quot;).addEventListener(&quot;change&quot;, function (event) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        let output = document.getElementById(&quot;listing&quot;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        let files = event.target.files;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        for (let i = 0; i &lt; files.length; i++) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            let item = document.createElement(&quot;li&quot;);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            item.innerHTML = files[i].webkitRelativePath;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            output.appendChild(item);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }, false);</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/script&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>当input没有设置webkitdirectory（上传目录里所有文件）时，选择单文件，或多文件。webkitRelativePath都是空字符串。当加上webkitdirectory 后，选择一个目录点击上传，webkitRelativePath显示所有文件相对于选择目录的路径。比如选择style目录，点击上传，显示结果如下图。</p><p><img src="./_img/relativepath.png" alt="relativePath"/></p><p>File接口没有定义任何方法，但是继承了Blob接口的方法。</p><h2><a aria-hidden="true" class="anchor" id="filereader"></a><a aria-hidden="true" class="hash-link" href="#filereader">#</a>FileReader</h2><p>FileReader可以用来异步读取File对象的信息。比如我们需要在文件上传时显示上传的图片。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;input type=&quot;file&quot; class=&quot;file&quot;&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;img src=&quot;&quot; alt=&quot;&quot; class=&quot;preview&quot;&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;button type=&quot;button&quot; class=&quot;btn&quot;&gt;点击&lt;/button&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;script&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    var file = document.querySelector(&#x27;.file&#x27;)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    var preview = document.querySelector(&#x27;.preview&#x27;)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    var btn = document.querySelector(&#x27;.btn&#x27;)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    btn.onclick = function (e) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        var f = file.files[0]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        var reader = new FileReader()</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        reader.onload = function (e) {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            console.log(e.target === this) // true</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            preview.src = e.target.result</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        reader.readAsDataURL(f)</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/script&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><img src="./_img/readasurl.png" alt="files"/></p><p>接着来详细了解FileReader的属性和方法。</p><p>通过new FileReader()创建一个FileReader对象。它读取文件相关的方法如下：</p><ul><li>readAsArrayBuffer()：以buffer形式读。</li><li>readAsBinaryString()：以二进制形式读。</li><li>readAsDateURL()：以data:URL格式读，比如图片读出来就是base64格式。</li><li>readAsText()：以文本形式读。</li><li>abort()：中止读取操作，在返回时，readyState属性为DONE。</li></ul><p>在开始读之前，我们需要先监听FileReader.readyState的变化，这点和ajax类型。可用事件如下：</p><ul><li>onabort：读取中止时触发。</li><li>onerror：读取发生错误时触发。</li><li>onload：读取完成时触发。</li><li>onloadstart：开始读取时触发。</li><li>onloadend：读取结束时触发，不管成功还是失败。</li><li>onprogress：读取时触发。</li></ul><p>FileReader.readyState可能值如下：</p><ul><li>0，EMPTY  还没有加载任何数据</li><li>1，LOADING 数据正在加载</li><li>2，DONE  完成全部请求</li></ul><p>最后的读取结果是<code>FileReader.result</code>。如果发生错误，会抛出一个<code>DOMException</code>，信息储存在<code>FileReader.error</code>中。</p><h2><a aria-hidden="true" class="anchor" id="urlcreateobjecturl"></a><a aria-hidden="true" class="hash-link" href="#urlcreateobjecturl">#</a>URL.createObjectURL()</h2><p>URL.createObjectURL(blob)接受一个blob或file对象，创建一个对象的本地url。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">var src = URL.createObjectURL(file.files[0])</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">preview.src = src</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">// 结果</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">blob:http://localhost:63342/35e2dba0-b306-4a6f-a755-5339f398eff9</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="createimagebitmap"></a><a aria-hidden="true" class="hash-link" href="#createimagebitmap">#</a>createImageBitmap</h2><p><code>window.createImageBitmap</code>是一个全局属性。待研究。</p><h2><a aria-hidden="true" class="anchor" id="参考资料-2"></a><a aria-hidden="true" class="hash-link" href="#参考资料-2">#</a>参考资料</h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File">MDN file api</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader">FileReader</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME 类型</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">Blob</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/createImageBitmap">self.createImageBitmap()</a></li></ul></div></article><div class="margin-top--xl margin-bottom--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/f2e/browser/event"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->浏览器事件机制</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/f2e/browser/storage"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">浏览器存储<!-- --> »</h4></a></div></nav><div id="gitalk-container"></div></div></div></div><div class="col col--3"><div class="tableOfContents_1X5y"><ul class="contents contents__left-border"><li><a href="#简介" class="contents__link">简介</a></li><li><a href="#xmlhttprequest-对象" class="contents__link">XMLHttpRequest 对象</a></li><li><a href="#表单提交" class="contents__link">表单提交</a></li><li><a href="#同源政策" class="contents__link">同源政策</a></li><li><a href="#跨域的解决方案" class="contents__link">跨域的解决方案</a><ul class=""><li><a href="#jsonp" class="contents__link">jsonp</a></li><li><a href="#cors" class="contents__link">CORS</a></li><li><a href="#postmessage" class="contents__link">postMessage</a></li><li><a href="#windowname" class="contents__link">window.name</a></li><li><a href="#hash" class="contents__link">hash</a></li><li><a href="#documentdomain" class="contents__link">document.domain</a></li><li><a href="#websocket" class="contents__link">websocket</a></li></ul></li><li><a href="#图片上传" class="contents__link">图片上传</a><ul class=""><li><a href="#传统的file-input" class="contents__link">传统的file input</a></li><li><a href="#ajax--readfile" class="contents__link">ajax + ReadFile()</a></li><li><a href="#ajax--formdata" class="contents__link">ajax + FormData()</a></li></ul></li><li><a href="#遇到的一些坑" class="contents__link">遇到的一些坑</a></li><li><a href="#mime-类型" class="contents__link">mime 类型</a><ul class=""><li><a href="#applicationoctet-stream" class="contents__link">application/octet-stream</a></li><li><a href="#textplain" class="contents__link">text/plain</a></li><li><a href="#textcss" class="contents__link">text/css</a></li><li><a href="#texthtml" class="contents__link">text/html</a></li><li><a href="#图片类型" class="contents__link">图片类型</a></li><li><a href="#音频和视频类型" class="contents__link">音频和视频类型</a></li><li><a href="#multipartform-data" class="contents__link">multipart/form-data</a></li><li><a href="#mime-嗅探" class="contents__link">MIME 嗅探</a></li><li><a href="#其他检查文件类型的方法" class="contents__link">其他检查文件类型的方法</a></li></ul></li><li><a href="#面试题" class="contents__link">面试题</a></li><li><a href="#参考资料" class="contents__link">参考资料</a></li><li><a href="#使用ajax" class="contents__link">使用ajax</a></li><li><a href="#formdata" class="contents__link">FormData</a><ul class=""><li><a href="#formdata-api" class="contents__link">FormData API</a></li><li><a href="#jquery里使用formdata" class="contents__link">jQuery里使用FormData</a></li></ul></li><li><a href="#参考资料-1" class="contents__link">参考资料</a></li><li><a href="#blob" class="contents__link">Blob</a></li><li><a href="#file" class="contents__link">File</a></li><li><a href="#filereader" class="contents__link">FileReader</a></li><li><a href="#urlcreateobjecturl" class="contents__link">URL.createObjectURL()</a></li><li><a href="#createimagebitmap" class="contents__link">createImageBitmap</a></li><li><a href="#参考资料-2" class="contents__link">参考资料</a></li></ul></div></div></div></div></div></main></div></div>
</div>

<script type="text/javascript" src="/runtime~main.0b078f7cdcdfcdb429c2.js"></script>

<script type="text/javascript" src="/main.477abd2e0f7ae11842aa.js"></script>

<script type="text/javascript" src="/0.c9587aaf32602224b53a.js"></script>

<script type="text/javascript" src="/1.b87e7195a03649b49435.js"></script>

<script type="text/javascript" src="/2.e8f1f759c4320c5032f6.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-page-9-e-7-ca5.1085c0ca4dac1d879092.js"></script>

<script type="text/javascript" src="/docsMetadata---docs-9-a-9-239.efc62167d7e7e974bd14.js"></script>

<script type="text/javascript" src="/3.7c5f5d1df2cb93bbc10a.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-item-031-769.63af36fb5b293fb44f17.js"></script>

<script type="text/javascript" src="/content---docs-f-2-e-browser-fetch-147-732.73df2df1c899b03dcdb5.js"></script>

<script type="text/javascript" src="/metadata---docs-f-2-e-browser-fetch-918-58f.67ea03597bbedee8f8cb.js"></script>

</body>
</html>