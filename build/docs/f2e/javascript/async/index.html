<!DOCTYPE html>
<html lang=&#34;en&#34; data-theme=&#34;&#34;>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.d719e73e126f22665d27.css","/main.29b855f1437804751f1d.js"],"component---site-src-pages-index-jsc-4-f-f99":["/component---site-src-pages-index-jsc-4-f-f99.7f8bb42332d3fb863b06.js"],"component---theme-blog-post-pageccc-cab":["/component---theme-blog-post-pageccc-cab.ced20f25f94d0873aeba.js"],"content---blog-2019-08-12-think-house-362-b31":["/content---blog-2019-08-12-think-house-362-b31.7bfca02379174084647c.js"],"metadata---blog-2019-08-12-think-house-3-b-6-904":["/metadata---blog-2019-08-12-think-house-3-b-6-904.e4abc27fb29409774fb9.js"],"component---theme-blog-list-pagea-6-a-7ba":["/component---theme-blog-list-pagea-6-a-7ba.79a80e7bef539e98375d.js"],"content---bloga-55-f4d":["/content---bloga-55-f4d.d20fca78e9f81f09f58a.js"],"metadata---blog-92-a-15c":["/metadata---blog-92-a-15c.4651a8475399e465ee3d.js"],"component---theme-doc-legacy-page-9-e-7-ca5":["/component---theme-doc-legacy-page-9-e-7-ca5.3c38a2f40a51efdd72a0.css","/component---theme-doc-legacy-page-9-e-7-ca5.083ae7dbb31619c2179f.js"],"docsMetadata---docs-9-a-9-239":["/docsMetadata---docs-9-a-9-239.3af23731f0531e526af4.js"],"component---theme-doc-legacy-item-031-769":["/component---theme-doc-legacy-item-031-769.2f2552f02b6a918fee59.css","/component---theme-doc-legacy-item-031-769.7e9f9ea227b79fde56c9.js"],"content---docs-about-3-d-8-538":["/content---docs-about-3-d-8-538.0cdb5db1108032725cf2.js"],"metadata---docs-about-443-9ff":["/metadata---docs-about-443-9ff.25ea176acbe69fcd5b04.js"],"content---docs-base-compute-combinef-7-f-933":["/content---docs-base-compute-combinef-7-f-933.231ead26aa5558ff77f6.js"],"metadata---docs-base-compute-combine-480-a12":["/metadata---docs-base-compute-combine-480-a12.75f8f601b1064db7eaf7.js"],"content---docs-database-mongo-2-c-4-a31":["/content---docs-database-mongo-2-c-4-a31.f1116cbb4d99fef98c09.js"],"metadata---docs-database-mongo-0-c-2-f76":["/metadata---docs-database-mongo-0-c-2-f76.6e84adf1e2fd20ce2694.js"],"content---docs-database-redise-5-d-9ae":["/content---docs-database-redise-5-d-9ae.e35852479966beef216d.js"],"metadata---docs-database-redis-4-a-0-66e":["/metadata---docs-database-redis-4-a-0-66e.1ffa6e8487611ab1b0ca.js"],"content---docs-demo-index-648-2ab":["/content---docs-demo-index-648-2ab.a51d1197ba73ef90ef3a.js"],"metadata---docs-demo-indexa-04-089":["/metadata---docs-demo-indexa-04-089.32f5fc966c43617cee06.js"],"content---docs-database-mysql-561-697":["/content---docs-database-mysql-561-697.fc80c12d1c9494604aed.js"],"metadata---docs-database-mysql-2-f-1-3e5":["/metadata---docs-database-mysql-2-f-1-3e5.994df442e7d25d22ee8e.js"],"content---docs-base-h-5586-54d":["/content---docs-base-h-5586-54d.3b9b8c7adab19104174f.js"],"metadata---docs-base-h-515-a-1cb":["/metadata---docs-base-h-515-a-1cb.53a5b158bc50a0f08081.js"],"content---docs-linux-service-49-b-272":["/content---docs-linux-service-49-b-272.d5f109bf7beb8f2dc1df.js"],"metadata---docs-linux-serviceac-8-d7f":["/metadata---docs-linux-serviceac-8-d7f.3da92e8131bd1de41121.js"],"content---docs-linux-fileec-1-765":["/content---docs-linux-fileec-1-765.d3e046c69657eef09188.js"],"metadata---docs-linux-file-65-c-c93":["/metadata---docs-linux-file-65-c-c93.011e4447ba24133111bb.js"],"content---docs-linux-soft-422-6cf":["/content---docs-linux-soft-422-6cf.52971f73dbf06b69f76b.js"],"metadata---docs-linux-softe-01-10b":["/metadata---docs-linux-softe-01-10b.b6c345c11378c6cb71fb.js"],"content---docs-algo-indexb-4-f-54a":["/content---docs-algo-indexb-4-f-54a.c3edbccca1238c1ff8dc.js"],"metadata---docs-algo-index-812-55b":["/metadata---docs-algo-index-812-55b.55c3ea33f026eef4c83b.js"],"content---docs-linux-indexcb-8-9a7":["/content---docs-linux-indexcb-8-9a7.19f27ffa4dfb056b98c7.js"],"metadata---docs-linux-index-73-e-38c":["/metadata---docs-linux-index-73-e-38c.3fba2ef3011c4c10a0be.js"],"content---docs-nodejs-npm-792-f52":["/content---docs-nodejs-npm-792-f52.e92a41c9e0b680a49c0a.js"],"metadata---docs-nodejs-npm-9-e-0-1d7":["/metadata---docs-nodejs-npm-9-e-0-1d7.acdc7d56d4996860f8d0.js"],"content---docs-nodejs-async-7-f-4-0af":["/content---docs-nodejs-async-7-f-4-0af.c9d6fcfc60b743602af7.js"],"metadata---docs-nodejs-asyncc-40-22b":["/metadata---docs-nodejs-asyncc-40-22b.e7a78dc940b79effb140.js"],"content---docs-nodejs-safee-0-a-532":["/content---docs-nodejs-safee-0-a-532.1e30b1a8a3e4e2ee6374.js"],"metadata---docs-nodejs-safe-287-46f":["/metadata---docs-nodejs-safe-287-46f.89b69df44cbbd96b1c3d.js"],"content---docs-nodejs-testaf-7-5fa":["/content---docs-nodejs-testaf-7-5fa.54af049aa76149d2e6f7.js"],"metadata---docs-nodejs-testbf-0-08d":["/metadata---docs-nodejs-testbf-0-08d.74cd82c6c674e51b8194.js"],"content---docs-other-blogaab-295":["/content---docs-other-blogaab-295.aa75283e1cda5bd94f15.js"],"metadata---docs-other-blogc-8-f-558":["/metadata---docs-other-blogc-8-f-558.a4ba12f512bb8f99c1fd.js"],"content---docs-other-kindle-rss-789-941":["/content---docs-other-kindle-rss-789-941.8c11a349d7cee9ccbc0f.js"],"metadata---docs-other-kindle-rssb-06-572":["/metadata---docs-other-kindle-rssb-06-572.4a43b742b6121f2b17f8.js"],"content---docs-other-maced-3-b03":["/content---docs-other-maced-3-b03.452a90222d23dc94ff37.js"],"metadata---docs-other-macc-8-c-bc8":["/metadata---docs-other-macc-8-c-bc8.fe37aafb6b9a3c38cc28.js"],"content---docs-nginx-index-16-d-468":["/content---docs-nginx-index-16-d-468.a248ad130afc861f3e92.js"],"metadata---docs-nginx-index-4-a-2-2e4":["/metadata---docs-nginx-index-4-a-2-2e4.60db8d89b2038e25637f.js"],"content---docs-nodejs-utild-25-062":["/content---docs-nodejs-utild-25-062.878913379243bfdb63d2.js"],"metadata---docs-nodejs-util-0-fd-711":["/metadata---docs-nodejs-util-0-fd-711.0fe06a4ae902293430a6.js"],"content---docs-other-resourceea-2-ecf":["/content---docs-other-resourceea-2-ecf.2c8b800d384082a44375.js"],"metadata---docs-other-resource-348-7b5":["/metadata---docs-other-resource-348-7b5.47fa4d79acfb6a69bb13.js"],"content---docs-patterns-builder-5-e-5-e3a":["/content---docs-patterns-builder-5-e-5-e3a.c25471ea3808f28287f6.js"],"metadata---docs-patterns-builderead-d21":["/metadata---docs-patterns-builderead-d21.7dd42b337e0335ed8cd0.js"],"content---docs-patterns-adapter-555-7ec":["/content---docs-patterns-adapter-555-7ec.7eaadab58adb4865b711.js"],"metadata---docs-patterns-adapter-464-f76":["/metadata---docs-patterns-adapter-464-f76.e031ab99cafca37937fa.js"],"content---docs-patterns-bridge-335-1e9":["/content---docs-patterns-bridge-335-1e9.43861f198757b90d6cbf.js"],"metadata---docs-patterns-bridgefbb-495":["/metadata---docs-patterns-bridgefbb-495.21778ffa3cf41765c1e1.js"],"content---docs-patterns-action-61-d-c76":["/content---docs-patterns-action-61-d-c76.bc0a52f34aea298a6a39.js"],"metadata---docs-patterns-action-124-4bd":["/metadata---docs-patterns-action-124-4bd.d5fbbbdd31c246fceeea.js"],"content---docs-patterns-composite-33-e-80d":["/content---docs-patterns-composite-33-e-80d.f535459f884a492e1466.js"],"metadata---docs-patterns-composite-238-38a":["/metadata---docs-patterns-composite-238-38a.4c46f4087acf54ca2b01.js"],"content---docs-patterns-chain-of-responsibility-579-dfa":["/content---docs-patterns-chain-of-responsibility-579-dfa.2b4275327d37ffa33c95.js"],"metadata---docs-patterns-chain-of-responsibility-014-8a0":["/metadata---docs-patterns-chain-of-responsibility-014-8a0.9951f35a8059ccf4e5ca.js"],"content---docs-patterns-commande-85-4af":["/content---docs-patterns-commande-85-4af.d677e22977eb10427c59.js"],"metadata---docs-patterns-command-80-a-50e":["/metadata---docs-patterns-command-80-a-50e.82cd7b822e4720dcc33a.js"],"content---docs-patterns-decorator-944-f6d":["/content---docs-patterns-decorator-944-f6d.f072b572157c719c2db2.js"],"metadata---docs-patterns-decorator-142-9e2":["/metadata---docs-patterns-decorator-142-9e2.734fd1375e59ee24e30a.js"],"content---docs-patterns-flyweighte-43-831":["/content---docs-patterns-flyweighte-43-831.ddcbb008de73cac7c512.js"],"metadata---docs-patterns-flyweightaba-d18":["/metadata---docs-patterns-flyweightaba-d18.6d34cd032b5e9bbd47c7.js"],"content---docs-patterns-facade-4-ef-b2f":["/content---docs-patterns-facade-4-ef-b2f.e4778fc6b4bf8c99d35c.js"],"metadata---docs-patterns-facade-7-a-8-297":["/metadata---docs-patterns-facade-7-a-8-297.33e7511b65ff85021890.js"],"content---docs-patterns-interpreterc-34-4ff":["/content---docs-patterns-interpreterc-34-4ff.6cd25c2c387850e708af.js"],"metadata---docs-patterns-interpreter-484-b15":["/metadata---docs-patterns-interpreter-484-b15.7c314b3fd7dab0b17c3a.js"],"content---docs-patterns-index-90-d-78a":["/content---docs-patterns-index-90-d-78a.27d6ca8981109c029600.js"],"metadata---docs-patterns-index-63-b-9e3":["/metadata---docs-patterns-index-63-b-9e3.6eb8033653853811dadd.js"],"content---docs-patterns-factoryf-00-197":["/content---docs-patterns-factoryf-00-197.f0ee8283a428f9ef0682.js"],"metadata---docs-patterns-factory-659-5cc":["/metadata---docs-patterns-factory-659-5cc.0ec37553a66543c11a9d.js"],"content---docs-patterns-prototype-93-c-d70":["/content---docs-patterns-prototype-93-c-d70.28dbca35664e86204e6b.js"],"metadata---docs-patterns-prototype-8-ac-89b":["/metadata---docs-patterns-prototype-8-ac-89b.1eaefa8f607561af62db.js"],"content---docs-patterns-iterator-3-bc-1d4":["/content---docs-patterns-iterator-3-bc-1d4.daf926176de418c7067e.js"],"metadata---docs-patterns-iterator-288-f03":["/metadata---docs-patterns-iterator-288-f03.9f4de71e19d8d245c863.js"],"content---docs-patterns-mediator-685-4ef":["/content---docs-patterns-mediator-685-4ef.b9990b555f09b24ea82a.js"],"metadata---docs-patterns-mediator-421-d91":["/metadata---docs-patterns-mediator-421-d91.f2815699f3b83964741a.js"],"content---docs-patterns-memento-740-286":["/content---docs-patterns-memento-740-286.98bd2cec2bb4c732ccad.js"],"metadata---docs-patterns-memento-098-f69":["/metadata---docs-patterns-memento-098-f69.06cd8af2fef2241a695e.js"],"content---docs-patterns-proxyb-6-e-4ef":["/content---docs-patterns-proxyb-6-e-4ef.c5027640233873c44662.js"],"metadata---docs-patterns-proxye-47-a3c":["/metadata---docs-patterns-proxye-47-a3c.0156d0c68d329882f13e.js"],"content---docs-patterns-stated-4-a-502":["/content---docs-patterns-stated-4-a-502.f309e13872b80d6c0250.js"],"metadata---docs-patterns-stateb-04-819":["/metadata---docs-patterns-stateb-04-819.6968da4d8a23cd4c21bc.js"],"content---docs-patterns-observer-73-f-441":["/content---docs-patterns-observer-73-f-441.6ed59a2bec8ccde1db49.js"],"metadata---docs-patterns-observere-90-4f8":["/metadata---docs-patterns-observere-90-4f8.2aae9e3841cb6bcd9e42.js"],"content---docs-patterns-singleton-710-727":["/content---docs-patterns-singleton-710-727.c6012c3fea6604cc168a.js"],"metadata---docs-patterns-singletonb-35-b33":["/metadata---docs-patterns-singletonb-35-b33.3dc5c9037c63c3c8bc2c.js"],"content---docs-patterns-templateee-1-6e8":["/content---docs-patterns-templateee-1-6e8.70ee93bc5c835e38d896.js"],"metadata---docs-patterns-template-3-bc-bf3":["/metadata---docs-patterns-template-3-bc-bf3.da349041b42af38983a8.js"],"content---docs-patterns-visitorff-6-bda":["/content---docs-patterns-visitorff-6-bda.d91182c29c52b13eddeb.js"],"metadata---docs-patterns-visitore-38-a38":["/metadata---docs-patterns-visitore-38-a38.014438c137abc7e9a4dd.js"],"content---docs-base-net-http-1-cc-352":["/content---docs-base-net-http-1-cc-352.6c0093da4ae06755541a.js"],"metadata---docs-base-net-http-373-f55":["/metadata---docs-base-net-http-373-f55.e33eea41174a01b05f1e.js"],"content---docs-patterns-strategy-9-e-9-61c":["/content---docs-patterns-strategy-9-e-9-61c.f4ea9c8c847e6158cf67.js"],"metadata---docs-patterns-strategy-6-ce-04f":["/metadata---docs-patterns-strategy-6-ce-04f.a77a3448fd6dcf49a380.js"],"content---docs-f-2-e-browser-cache-260-909":["/content---docs-f-2-e-browser-cache-260-909.33f8fb14f0458db300fe.js"],"metadata---docs-f-2-e-browser-cache-361-a94":["/metadata---docs-f-2-e-browser-cache-361-a94.ca8308807878504684c9.js"],"content---docs-f-2-e-browser-devtool-850-efc":["/content---docs-f-2-e-browser-devtool-850-efc.d2a9ed6e5aa25992958e.js"],"metadata---docs-f-2-e-browser-devtool-3-ab-d05":["/metadata---docs-f-2-e-browser-devtool-3-ab-d05.603da1e90dce7d64e366.js"],"content---docs-base-net-tcpd-0-c-487":["/content---docs-base-net-tcpd-0-c-487.31d257b9795c59d0b3e4.js"],"metadata---docs-base-net-tcp-212-c6f":["/metadata---docs-base-net-tcp-212-c6f.c2d636e4bc329b5b184c.js"],"content---docs-f-2-e-browser-dom-018-426":["/content---docs-f-2-e-browser-dom-018-426.b2632a897c0b260cae3e.js"],"metadata---docs-f-2-e-browser-domb-41-90c":["/metadata---docs-f-2-e-browser-domb-41-90c.ff5fc5fd896dfcaf9c08.js"],"content---docs-f-2-e-browser-eventa-5-d-93e":["/content---docs-f-2-e-browser-eventa-5-d-93e.d70785c0e80887dd7de1.js"],"metadata---docs-f-2-e-browser-event-0-cc-f3c":["/metadata---docs-f-2-e-browser-event-0-cc-f3c.71c70477eb9b2c39a255.js"],"content---docs-f-2-e-browser-storage-0-e-2-cd2":["/content---docs-f-2-e-browser-storage-0-e-2-cd2.f9871804b67c935cad4f.js"],"metadata---docs-f-2-e-browser-storagea-21-a7b":["/metadata---docs-f-2-e-browser-storagea-21-a7b.6ba0b9b3b027f82533e7.js"],"content---docs-f-2-e-browser-eventloop-473-bc4":["/content---docs-f-2-e-browser-eventloop-473-bc4.0d4e3568824bfbefaff2.js"],"metadata---docs-f-2-e-browser-eventloopcbb-9eb":["/metadata---docs-f-2-e-browser-eventloopcbb-9eb.2285d83710eac5aa7bb5.js"],"content---docs-f-2-e-browser-fetch-147-732":["/content---docs-f-2-e-browser-fetch-147-732.b4ea8b46ea179c7ff3f1.js"],"metadata---docs-f-2-e-browser-fetch-918-58f":["/metadata---docs-f-2-e-browser-fetch-918-58f.fd89ed3769f84f6a630f.js"],"content---docs-f-2-e-browser-v-8-c-83-515":["/content---docs-f-2-e-browser-v-8-c-83-515.fa7a69ceb3ca708b1f54.js"],"metadata---docs-f-2-e-browser-v-8-e-60-c45":["/metadata---docs-f-2-e-browser-v-8-e-60-c45.5363018de27b404acf9a.js"],"content---docs-f-2-e-browser-work-31-f-d77":["/content---docs-f-2-e-browser-work-31-f-d77.9f30e86d2e5a85241f60.js"],"metadata---docs-f-2-e-browser-work-9-d-7-1ef":["/metadata---docs-f-2-e-browser-work-9-d-7-1ef.668ded6b3b0e8590d175.js"],"content---docs-f-2-e-css-indexf-55-541":["/content---docs-f-2-e-css-indexf-55-541.55fe7d975ebddf401b27.js"],"metadata---docs-f-2-e-css-indexe-08-461":["/metadata---docs-f-2-e-css-indexe-08-461.04db62e1f5153a2dc43a.js"],"content---docs-f-2-e-javascript-grammer-447-369":["/content---docs-f-2-e-javascript-grammer-447-369.03db4da1b760fb262eb1.js"],"metadata---docs-f-2-e-javascript-grammer-6-df-3af":["/metadata---docs-f-2-e-javascript-grammer-6-df-3af.c29659dfa0d7eb6e6dfe.js"],"content---docs-f-2-e-javascript-modulee-10-ff1":["/content---docs-f-2-e-javascript-modulee-10-ff1.562f16260c56613a860a.js"],"metadata---docs-f-2-e-javascript-moduleee-6-b43":["/metadata---docs-f-2-e-javascript-moduleee-6-b43.b3558e0e174066e9680e.js"],"content---docs-f-2-e-javascript-asynceb-2-d37":["/content---docs-f-2-e-javascript-asynceb-2-d37.2d3aff55d5f2b86fc6f8.js"],"metadata---docs-f-2-e-javascript-async-09-f-030":["/metadata---docs-f-2-e-javascript-async-09-f-030.69ab038418723167bf52.js"],"content---docs-f-2-e-html-index-9-d-1-79a":["/content---docs-f-2-e-html-index-9-d-1-79a.5ea22302377abaf29c85.js"],"metadata---docs-f-2-e-html-index-24-f-1e4":["/metadata---docs-f-2-e-html-index-24-f-1e4.b0ff7d2b606372e86c40.js"],"content---docs-f-2-e-javascript-oop-3-a-2-e5a":["/content---docs-f-2-e-javascript-oop-3-a-2-e5a.94993c60a69e1c353874.js"],"metadata---docs-f-2-e-javascript-oopaa-3-9b9":["/metadata---docs-f-2-e-javascript-oopaa-3-9b9.dddc05bf799b43990a71.js"],"content---docs-f-2-e-javascript-type-58-e-e47":["/content---docs-f-2-e-javascript-type-58-e-e47.3fb6d9b368caa7ac6e77.js"],"metadata---docs-f-2-e-javascript-typef-33-dde":["/metadata---docs-f-2-e-javascript-typef-33-dde.c6f0a55dbaa5855c6938.js"],"content---docs-f-2-e-javascript-skill-687-c8f":["/content---docs-f-2-e-javascript-skill-687-c8f.ed3626e1e267af5e31b3.js"],"metadata---docs-f-2-e-javascript-skilld-97-3a2":["/metadata---docs-f-2-e-javascript-skilld-97-3a2.eecd3443f358131fbec2.js"],"content---docs-f-2-e-monitor-index-391-ad0":["/content---docs-f-2-e-monitor-index-391-ad0.20c3daeedc557126273d.js"],"metadata---docs-f-2-e-monitor-indexa-56-d7f":["/metadata---docs-f-2-e-monitor-indexa-56-d7f.5b5646bb22b48238c2ca.js"],"content---docs-f-2-e-performance-indexaef-e1d":["/content---docs-f-2-e-performance-indexaef-e1d.4515ff19df77939844ab.js"],"metadata---docs-f-2-e-performance-index-3-de-87c":["/metadata---docs-f-2-e-performance-index-3-de-87c.faa1dd620ab82b1aaf70.js"],"content---docs-f-2-e-react-index-0-cb-3f0":["/content---docs-f-2-e-react-index-0-cb-3f0.2d1067a2c7105cac798e.js"],"metadata---docs-f-2-e-react-indexc-85-6a6":["/metadata---docs-f-2-e-react-indexc-85-6a6.fce97b82ac90b1252c11.js"],"content---docs-f-2-e-javascript-regexp-987-85e":["/content---docs-f-2-e-javascript-regexp-987-85e.ba128574b95df31fe576.js"],"metadata---docs-f-2-e-javascript-regexp-239-ff9":["/metadata---docs-f-2-e-javascript-regexp-239-ff9.57f009d246b1d89850c4.js"],"content---docs-f-2-e-react-native-alert-6-d-1-303":["/content---docs-f-2-e-react-native-alert-6-d-1-303.29a0f424e146706fd0f6.js"],"metadata---docs-f-2-e-react-native-alert-5-f-9-3e3":["/metadata---docs-f-2-e-react-native-alert-5-f-9-3e3.7ad5ae2657698f386b47.js"],"content---docs-f-2-e-react-native-bugly-8-d-4-ab2":["/content---docs-f-2-e-react-native-bugly-8-d-4-ab2.ed22d25df317ac08d2b2.js"],"metadata---docs-f-2-e-react-native-buglyadb-596":["/metadata---docs-f-2-e-react-native-buglyadb-596.219ef7f600bea6868d62.js"],"content---docs-f-2-e-react-native-androide-34-3a4":["/content---docs-f-2-e-react-native-androide-34-3a4.77aa5a03e0070f9a6383.js"],"metadata---docs-f-2-e-react-native-android-0-b-3-456":["/metadata---docs-f-2-e-react-native-android-0-b-3-456.625e210e1a0c780d680d.js"],"content---docs-f-2-e-safe-index-165-7db":["/content---docs-f-2-e-safe-index-165-7db.df3f3af4eb2c57ba6167.js"],"metadata---docs-f-2-e-safe-index-647-b0c":["/metadata---docs-f-2-e-safe-index-647-b0c.1121f44c8ad64c188e34.js"],"content---docs-f-2-e-react-native-deploy-500-e54":["/content---docs-f-2-e-react-native-deploy-500-e54.3d186d8cdbcd27cb4328.js"],"metadata---docs-f-2-e-react-native-deploy-4-cf-03c":["/metadata---docs-f-2-e-react-native-deploy-4-cf-03c.a56bfe6a857f332dacb3.js"],"content---docs-f-2-e-react-native-code-pusha-39-174":["/content---docs-f-2-e-react-native-code-pusha-39-174.ddd506d6bdf3cf34606e.js"],"metadata---docs-f-2-e-react-native-code-push-7-b-7-231":["/metadata---docs-f-2-e-react-native-code-push-7-b-7-231.333762a860b8d052f32f.js"],"content---docs-f-2-e-react-native-fetch-756-af5":["/content---docs-f-2-e-react-native-fetch-756-af5.4ee736a46ff65de92f28.js"],"metadata---docs-f-2-e-react-native-fetchd-41-27d":["/metadata---docs-f-2-e-react-native-fetchd-41-27d.47dd88250fc225df7306.js"],"content---docs-f-2-e-test-jestfc-3-df1":["/content---docs-f-2-e-test-jestfc-3-df1.0d88a69b0b988276e59b.js"],"metadata---docs-f-2-e-test-jestda-3-2d2":["/metadata---docs-f-2-e-test-jestda-3-2d2.62f5193e9a5d85f543dd.js"],"content---docs-f-2-e-test-index-1-ae-bf1":["/content---docs-f-2-e-test-index-1-ae-bf1.3407a97d9ff43634476a.js"],"metadata---docs-f-2-e-test-index-47-d-1a6":["/metadata---docs-f-2-e-test-index-47-d-1a6.43f3af0bac3e669199b7.js"],"content---docs-f-2-e-react-native-camera-597-89d":["/content---docs-f-2-e-react-native-camera-597-89d.2df521138e5afa83bd60.js"],"metadata---docs-f-2-e-react-native-camera-27-a-253":["/metadata---docs-f-2-e-react-native-camera-27-a-253.433cd563ceecceef1017.js"],"content---docs-f-2-e-react-native-gitf-9-e-d83":["/content---docs-f-2-e-react-native-gitf-9-e-d83.630596261f7095150114.js"],"metadata---docs-f-2-e-react-native-git-3-f-0-1e2":["/metadata---docs-f-2-e-react-native-git-3-f-0-1e2.3fa4caebdb06c3d42eb1.js"],"content---docs-f-2-e-react-native-form-7-a-1-0fb":["/content---docs-f-2-e-react-native-form-7-a-1-0fb.3c70785f97aae8b5d536.js"],"metadata---docs-f-2-e-react-native-form-69-e-589":["/metadata---docs-f-2-e-react-native-form-69-e-589.5314cd9361c4448e341a.js"],"content---docs-f-2-e-react-native-issue-0-f-6-864":["/content---docs-f-2-e-react-native-issue-0-f-6-864.2e6c45e23b6d4dd30a4a.js"],"metadata---docs-f-2-e-react-native-issue-214-5cd":["/metadata---docs-f-2-e-react-native-issue-214-5cd.3a6bcec66aea5429f6c5.js"],"content---docs-f-2-e-react-native-save-to-camera-693-68d":["/content---docs-f-2-e-react-native-save-to-camera-693-68d.6cb545435344993a96cb.js"],"metadata---docs-f-2-e-react-native-save-to-camera-7-a-4-735":["/metadata---docs-f-2-e-react-native-save-to-camera-7-a-4-735.fe7c0c64e05c0866fb85.js"],"content---docs-f-2-e-react-native-loading-84-c-73a":["/content---docs-f-2-e-react-native-loading-84-c-73a.bcdfac785f7c7f05dfc4.js"],"metadata---docs-f-2-e-react-native-loadingf-98-f5d":["/metadata---docs-f-2-e-react-native-loadingf-98-f5d.96be0ea0cbf60111725c.js"],"content---docs-f-2-e-react-native-share-to-wechatf-7-d-17b":["/content---docs-f-2-e-react-native-share-to-wechatf-7-d-17b.7a64adaae0e1a14c5fe6.js"],"metadata---docs-f-2-e-react-native-share-to-wechatd-32-d2a":["/metadata---docs-f-2-e-react-native-share-to-wechatd-32-d2a.b1af28f35d5dc3f6080f.js"],"content---docs-f-2-e-react-native-source-877-2ea":["/content---docs-f-2-e-react-native-source-877-2ea.48acc8f8b70bef14c761.js"],"metadata---docs-f-2-e-react-native-source-9-b-5-f09":["/metadata---docs-f-2-e-react-native-source-9-b-5-f09.1d37e51cfa896957e38b.js"],"content---docs-f-2-e-react-native-size-5-b-4-c24":["/content---docs-f-2-e-react-native-size-5-b-4-c24.b7b8d73e223d5400f928.js"],"metadata---docs-f-2-e-react-native-sizefa-9-e54":["/metadata---docs-f-2-e-react-native-sizefa-9-e54.c58f390a847ca250ea00.js"],"content---docs-f-2-e-react-native-index-889-a61":["/content---docs-f-2-e-react-native-index-889-a61.4d5cf4019cb6df9a0f6d.js"],"metadata---docs-f-2-e-react-native-indexb-92-e43":["/metadata---docs-f-2-e-react-native-indexb-92-e43.e34fa0941e62c80061da.js"],"content---docs-f-2-e-react-native-tech-226-30f":["/content---docs-f-2-e-react-native-tech-226-30f.c226d15e717795206e3a.js"],"metadata---docs-f-2-e-react-native-techbca-407":["/metadata---docs-f-2-e-react-native-techbca-407.a2fe02eeaed63705cfff.js"],"content---docs-f-2-e-react-native-waterfall-629-6ad":["/content---docs-f-2-e-react-native-waterfall-629-6ad.9765d76db1197cbad1e1.js"],"metadata---docs-f-2-e-react-native-waterfall-2-d-9-e37":["/metadata---docs-f-2-e-react-native-waterfall-2-d-9-e37.2a06577fcc25b1e63cbe.js"],"content---docs-f-2-e-react-native-update-rn-93-f-50e":["/content---docs-f-2-e-react-native-update-rn-93-f-50e.907b12b521f2cdab0181.js"],"metadata---docs-f-2-e-react-native-update-rn-323-92d":["/metadata---docs-f-2-e-react-native-update-rn-323-92d.6d5a081301bd1bd5d5e1.js"],"content---docs-f-2-e-react-native-react-native-videoc-1-d-e43":["/content---docs-f-2-e-react-native-react-native-videoc-1-d-e43.38925d30cae98ecce9c3.js"],"metadata---docs-f-2-e-react-native-react-native-video-97-c-eaa":["/metadata---docs-f-2-e-react-native-react-native-video-97-c-eaa.691cc11da67fd384e5f8.js"],"content---docs-f-2-e-vue-index-02-b-a5c":["/content---docs-f-2-e-vue-index-02-b-a5c.799584a3986412b84d99.js"],"metadata---docs-f-2-e-vue-indexefd-70b":["/metadata---docs-f-2-e-vue-indexefd-70b.d359a34feb5e559d6367.js"],"content---docs-f-2-e-react-native-wechate-7-f-088":["/content---docs-f-2-e-react-native-wechate-7-f-088.3c4b13fe93185d91dd14.js"],"metadata---docs-f-2-e-react-native-wechate-47-3f8":["/metadata---docs-f-2-e-react-native-wechate-47-3f8.e02de10e8b54b40bbf9e.js"],"content---docs-source-jquery-event-088-dda":["/content---docs-source-jquery-event-088-dda.b4d9ae545ee572133d3a.js"],"metadata---docs-source-jquery-event-095-2e1":["/metadata---docs-source-jquery-event-095-2e1.e012c5f4c9be5eda6580.js"],"content---docs-f-2-e-vue-zf-6-bb-fd6":["/content---docs-f-2-e-vue-zf-6-bb-fd6.33e5a096b0795a97b68e.js"],"metadata---docs-f-2-e-vue-zf-258-73c":["/metadata---docs-f-2-e-vue-zf-258-73c.4679d533f88344da2d47.js"],"content---docs-f-2-e-webpack-principle-indexab-1-27c":["/content---docs-f-2-e-webpack-principle-indexab-1-27c.545af9b44958fc817f27.js"],"metadata---docs-f-2-e-webpack-principle-index-6-fa-123":["/metadata---docs-f-2-e-webpack-principle-index-6-fa-123.f134d87345c0313f6deb.js"],"content---docs-f-2-e-vue-origind-8-a-797":["/content---docs-f-2-e-vue-origind-8-a-797.1a89b27a4ee992a30575.js"],"metadata---docs-f-2-e-vue-origin-587-f6e":["/metadata---docs-f-2-e-vue-origin-587-f6e.402df7e5632dce8a980f.js"],"content---docs-f-2-e-webpack-basic-indexb-92-061":["/content---docs-f-2-e-webpack-basic-indexb-92-061.a474aaf3b892206397c5.js"],"metadata---docs-f-2-e-webpack-basic-indexe-25-12c":["/metadata---docs-f-2-e-webpack-basic-indexe-25-12c.d779a324730773d7e8af.js"],"component---theme-blog-tags-posts-page-687-b6c":["/component---theme-blog-tags-posts-page-687-b6c.ea67dd4eca2858cc6027.js"],"metadata---blog-tags-house-375-d32":["/metadata---blog-tags-house-375-d32.1ee4710336603e7fc788.js"],"metadata---blog-tags-thinkd-55-455":["/metadata---blog-tags-thinkd-55-455.2bf3990a307cfa1e1db1.js"],"component---theme-blog-tags-list-page-01-a-d0b":["/component---theme-blog-tags-list-page-01-a-d0b.455154eb733aeb11ad89.js"],"tags---blog-tagse-51-a7c":["/tags---blog-tagse-51-a7c.002b573b0330b2919e44.js"]};/*]]>*/</script>

<title data-react-helmet="true">javascript 异步编程</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="javascript 异步编程"/><meta data-react-helmet="true" name="description" content="## 概念"/><meta data-react-helmet="true" property="og:description" content="## 概念"/><meta data-react-helmet="true" property="og:url" content="https://www.banli17.com/docs/f2e/javascript/async"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.d719e73e126f22665d27.css" />

<link rel="stylesheet" type="text/css" href="/1.196ce05925ea6d776920.css" />

<link rel="stylesheet" type="text/css" href="/2.76ced7e22babc8d30c3a.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-page-9-e-7-ca5.3c38a2f40a51efdd72a0.css" />

<link rel="stylesheet" type="text/css" href="/3.76fc2d47232fd1193413.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-item-031-769.2f2552f02b6a918fee59.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="板栗17的博客"/><strong>banli17.com</strong></a><a class="navbar__item navbar__link" label="前端" position="left" href="/docs/f2e/html/index">前端</a><a class="navbar__item navbar__link" label="源码笔记" position="left" href="/docs/source/jquery/event">源码笔记</a><a class="navbar__item navbar__link" label="NodeJS" position="left" href="/docs/nodejs/util">NodeJS</a><a class="navbar__item navbar__link" label="设计模式" position="left" href="/docs/patterns/index">设计模式</a><a class="navbar__item navbar__link" label="算法" position="left" href="/docs/algo/index">算法</a><a class="navbar__item navbar__link" label="服务器" position="left" href="/docs/linux/index">服务器</a><a class="navbar__item navbar__link" label="计算机基础" position="left" href="/docs/base/h5">计算机基础</a><a class="navbar__item navbar__link" label="工具" position="left" href="/docs/other/mac">工具</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" label="博客" position="right" href="/blog">博客</a><a class="navbar__item navbar__link" label="关于" position="right" href="/docs/about">关于</a><a class="navbar__item navbar__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="板栗17的博客"/><strong>banli17.com</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="前端" position="left" href="/docs/f2e/html/index">前端</a></li><li class="menu__list-item"><a class="menu__link" label="源码笔记" position="left" href="/docs/source/jquery/event">源码笔记</a></li><li class="menu__list-item"><a class="menu__link" label="NodeJS" position="left" href="/docs/nodejs/util">NodeJS</a></li><li class="menu__list-item"><a class="menu__link" label="设计模式" position="left" href="/docs/patterns/index">设计模式</a></li><li class="menu__list-item"><a class="menu__link" label="算法" position="left" href="/docs/algo/index">算法</a></li><li class="menu__list-item"><a class="menu__link" label="服务器" position="left" href="/docs/linux/index">服务器</a></li><li class="menu__list-item"><a class="menu__link" label="计算机基础" position="left" href="/docs/base/h5">计算机基础</a></li><li class="menu__list-item"><a class="menu__link" label="工具" position="left" href="/docs/other/mac">工具</a></li><li class="menu__list-item"><a class="menu__link" label="博客" position="right" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" label="关于" position="right" href="/docs/about">关于</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></div></div></nav><div class="container container--fluid"><div class="row"><div class="col col--3"><div class="sidebar_Qb2S"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1uhT" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Html</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/html/index">HTML</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Css</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/css/index">css基础</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/grammer">语法</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/type">数据类型</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/oop">面向对象</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/module">模块化编程</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/f2e/javascript/async">异步编程</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/regexp">正则表达式</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/javascript/skill">高级技巧</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">浏览器原理与API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/dom">DOM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/work">现代浏览器工作原理(翻译)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/eventloop">事件循环</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/event">事件机制</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/fetch">网络请求与表单</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/storage">浏览器存储</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/devtool">Chrome 开发者工具</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/cache">浏览器缓存机制</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/browser/v8">V8 引擎原理</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">其它</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/monitor/index">前端监控</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/test/index">前端测试与jest</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/safe/index">web 安全</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/performance/index">网站性能优化</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/webpack/basic/index">webpack (1): 官方文档总结</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/webpack/principle/index">webpack (2): 原理</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/react/index">React 知识点总结</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">vue</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/vue/index">知识点总结</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/f2e/vue/origin">原理分析</a></li></ul></li></ul></div></div></div><main class="col"><div><div class="padding-vert--lg"><div class="row"><div class="col"><div class="docItemContainer_1VCq"><header><h1 class="margin-bottom--lg">javascript 异步编程</h1></header><article><div class="markdown"><h2><a aria-hidden="true" class="anchor" id="概念"></a><a aria-hidden="true" class="hash-link" href="#概念">#</a>概念</h2><h3><a aria-hidden="true" class="anchor" id="并发和并行"></a><a aria-hidden="true" class="hash-link" href="#并发和并行">#</a>并发和并行</h3><p><img src="/static/img/js/async-1.jpg" alt="Erlang 之父 Joe Armstrong画的并发和并行图片"/></p><p>上图可以看到，并发(concurrency)同时来了多个任务；并行(parallelism)是多个任务同时在处理。</p><h2><a aria-hidden="true" class="anchor" id="异步发展"></a><a aria-hidden="true" class="hash-link" href="#异步发展">#</a>异步发展</h2><p>javascript 异步的发展大致经历了下面几个过程：</p><ol><li>回调函数</li><li>Generator</li><li>Promise</li><li>async + await </li></ol><h2><a aria-hidden="true" class="anchor" id="回调函数"></a><a aria-hidden="true" class="hash-link" href="#回调函数">#</a>回调函数</h2><p>回调函数就是一个通过函数指针调用的函数。回调函数有个缺点，就是很容易多层嵌套，也叫做回调地狱。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token function" style="color:rgb(130, 170, 255)">fn0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fn1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">fn2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面这样的代码很不容易阅读和维护。它的主要问题是：</p><ol><li>嵌套函数存在耦合性，修改会影响其它的。</li><li>错误不好处理。</li></ol><h2><a aria-hidden="true" class="anchor" id="生成器-generator"></a><a aria-hidden="true" class="hash-link" href="#生成器-generator">#</a>生成器 Generator</h2><h3><a aria-hidden="true" class="anchor" id="简介"></a><a aria-hidden="true" class="hash-link" href="#简介">#</a>简介</h3><p>Generator 是 ES6 的概念，叫做生成器，它会生成一个迭代器。迭代器有一个<code>next()</code>方法，每次调用会返回<code>value</code>和<code>done</code>，分别是迭代的值和迭代是否完成。</p><p>生成器的用法如下：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">g</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> it </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">g</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;x&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// { value: 1, done: false }</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// y</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// { value: 2, done: false }</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// z</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// { value: 3, done: true }</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>生成器其实就是一个特殊的函数，使用语法<code>function*</code>定义。它的内部可以使用<code>yield</code>关键字来暂停执行。generator 的执行是蛇形执行。执行过程如下：</p><ol><li>执行<code>it.next(&#x27;h&#x27;)</code>，函数会执行到<code>yield 1</code>后暂停。</li><li>执行<code>it.next(&#x27;i&#x27;)</code>，函数会给 a 赋值，并执行到<code>yield 2</code>后暂停。</li><li>执行<code>it.next(&#x27;!&#x27;)</code>，函数会给 b 赋值，并执行到最后。</li></ol><p>关于返回值，需要注意：</p><ul><li><code>next()</code>传递的参数是 yeild 语句的返回值，所以第一次调用next传递参数没有意义，因为没有变量接收。</li><li><code>next()</code>执行时返回的 value 值，是 yield 语句或 return 产出的值。</li></ul><p>再来看看下面这个例子。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> it </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// =&gt; {value: 6, done: false}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// =&gt; {value: 8, done: false}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// =&gt; {value: 42, done: true}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面代码执行步骤如下：</p><ol><li><code>it.next()</code>执行到<code>yield (5 + 1)</code>，相当于<code>yield 6</code>，所以输出<code>{value: 6}</code>。</li><li><code>it.next(12)</code>，传入的参数 12 会作为第一个 yeild 的返回值，所以 y = 2 * 12 ，即 24。<code>yield y/3</code>就是<code>yield 8</code>。</li><li><code>it.next(13)</code>，13 会传给 z，所以最后结果为 5 + 24 + 13 = 42。 </li></ol><blockquote><p>为什么<code>[...{name:&#x27;zs&#x27;, age: 12}]</code>会报错？</p></blockquote><p>因为解构或 for...of 会执行对象的<code>[Symbol.interator]</code>方法。普通对象 Object 不支持<code>for...of</code>，我们可以新增这个方法实现迭代。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> o </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;zs&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    age</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Symbol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">iterator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            keys </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">keys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    done</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> keys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">keys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">index</span><span class="token operator" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 使用 generator</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// [Symbol.iterator]: function* () {</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//     let index = 0, </span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//     keys = Object.keys(this);</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//     while(index !== keys.length){</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//         yield this[keys[index++]]</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">//     }</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// }</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(127, 219, 202)">of</span><span class="token plain"> o</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// &#x27;zs&#x27;, 12</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token spread operator" style="color:rgb(127, 219, 202)">...</span><span class="token plain">o</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// [&#x27;zs&#x27;, 12]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="co库原理"></a><a aria-hidden="true" class="hash-link" href="#co库原理">#</a>co库原理</h3><p>Generator 一般会配合 <a href="https://github.com/tj/co">co库</a> 使用。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// co 返回一个promise，并且会将迭代器的最终执行结果传递</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> fs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;fs&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> path </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;path&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> co </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;co&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">filepath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        fs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> filepath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;name.txt&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> b</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 使用co库</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">co</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 相当于是</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> it </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> value </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> value </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> value </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>可以看到 co 库会不断的解析<code>read()</code>，获得最终的返回值。</p><p>co的实现原理:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;name.txt&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">yield</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">readFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;utf8&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> b</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// co返回一个promise</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">co</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> it </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">typeof</span><span class="token plain"> param </span><span class="token operator" style="color:rgb(127, 219, 202)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;function&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">?</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> param</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> done </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">next</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">done</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// value可能不是promise</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token function" style="color:rgb(130, 170, 255)">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">param</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="promise"></a><a aria-hidden="true" class="hash-link" href="#promise">#</a>Promise</h2><h3><a aria-hidden="true" class="anchor" id="简介-1"></a><a aria-hidden="true" class="hash-link" href="#简介-1">#</a>简介</h3><p>Promise 是一个类，它的特点如下：</p><ol><li>Promise 初始状态是<code>pending</code>，通过 resolve() 或 reject() 可以将状态修改为<code>fulfilled(成功)</code>或<code>rejected(失败)</code>。如果状态是<code>pending</code>，回调函数永远不会被调用。而且状态一旦改变，就不能再改变。</li><li>Promise 无法中途取消，一旦新建它将立即执行。</li><li>Promise 状态是保存的，可以后续再添加回调函数。事件是错过后再监听，是监听不到的。</li></ol><p>下面几个方法是非常常用的。</p><ul><li>Promise.all()</li><li>Promise.resolve()</li><li>Promise.reject()</li><li>Promise.race()</li><li>Promise.prototype.then()</li><li>Promise.prototype.finally()</li><li>Promise.prototype.catch()</li></ul><p><strong>Promise和事件</strong></p><ul><li>Promise 只关心对结果做出反应，不关心过程。</li><li>事件有可能之前发生了，然后没有捕获到，比如图片加载时添加<code>img.onload</code>。</li><li>多个异步事件的处理，事件会很复杂。</li></ul><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-undefined codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;img src=&#x27;1.png&#x27; /&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;script src=&#x27;big.js&#x27;&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;script&gt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">img.onload = () =&gt; {}  // 这里可能不会执行 onload 事件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">&lt;/script&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ok&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;error&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">resolveCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rejectCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">resolveCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 这里调用的时候data就是ok</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rejectCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 这里调用的时候data就是error</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Promise 新建时就立即执行，就像执行一个函数一样，是同步的。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ok&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;promise&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 结果 promise -&gt; hello</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面代码也显示出，resolve() 和 reject() 不会阻止函数后续代码的执行。</p><p>Promise 的 then 方法，属于 micro-task 类型的异步任务。会在同步任务执行完成后，再执行。</p><p>下面是一个用 Promise 实现的图片下载的例子。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> img </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">img</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;http://xx.com/1.png&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">img</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">onload</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">img</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">img</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">onerror</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;img download error&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="promiseprototypethen"></a><a aria-hidden="true" class="hash-link" href="#promiseprototypethen">#</a>Promise.prototype.then()</h3><p>then 方法返回的是一个新的 Promise 对象，不是之前那个 Promise 对象。</p><p>如果前一个 then 方法返回 Promise，则后面的 then 方法会等待 Promise 状态变化后调用。如果返回的是值，则后面的 then 方法的参数就是这个返回值。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// then返回值</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// &#x27;hello&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;res&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// res</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// then返回Promise</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// &#x27;hello&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;xx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// xx</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="promiseprototypecatch"></a><a aria-hidden="true" class="hash-link" href="#promiseprototypecatch">#</a>Promise.prototype.catch()</h3><p>catch 方法是<code>.then(null, rejection)</code>的别名，用于捕获 Promise 内部的错误。</p><p>如果 Promise 里有错误或reject()，并且没有使用 then() 的 reject 回调方法，catch则会执行。如果 then 有 reject 回调则会拦截到异常，catch 将不会执行。(错误实际会使状态变为 rejected)</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;error&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;reject error&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 会执行</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;catch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">         </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 不执行</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>建议用 catch 来捕获异常，不要使用 then() 的 rejection。</p><p>在 resolve() 后抛出的异常不会被捕获。因为 Promise 状态已经改变，不会再发生变化了。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 不会执行</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>下面三段代码是等效的。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Error: test</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 写法一</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 写法二</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Node 里的 unhandledRejection 事件，用于捕获没有捕获的 reject 错误。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;unhandledRejection&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>下面这个例子。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;ok&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;test&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// ok</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Uncaught Error: test</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>setTimeout 时，Promise 已经执行完成了。所以错误会抛出到外层，成为未捕获的错误。</p><h3><a aria-hidden="true" class="anchor" id="promiseprototypefinally"></a><a aria-hidden="true" class="hash-link" href="#promiseprototypefinally">#</a>Promise.prototype.finally()</h3><p>finally 方法指定 Promise 对象最后的执行操作。不管状态是 fulfilled 还是 rejected。它不接受参数。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">finally</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 等同于</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>finally 的实现是：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method-variable function-variable method function property-access" style="color:rgb(130, 170, 255)">finally</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">P</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token parameter">value</span><span class="token plain">  </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">P</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token parameter">reason</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">P</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> reason </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="promiseall"></a><a aria-hidden="true" class="hash-link" href="#promiseall">#</a>Promise.all()</h3><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> p </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">all</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">task1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> task2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> task3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>task1, task2, task3 都是 Promise 对象。</p><p>当所有的 Promise 对象都是 fulfilled 时，p 才是 fulfilled。否则就是 rejected。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> p1 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">result</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> p2 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">throw</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;报错了&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">result</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">all</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">result</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 不会执行</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// [&quot;hello&quot;, Error: 报错了]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面的代码，p1 和 p2 都是 resolved (p2 在执行完 catch 后)。如果 p2 没有 catch，则 all 里面的 catch 会执行。</p><h3><a aria-hidden="true" class="anchor" id="promiserace"></a><a aria-hidden="true" class="hash-link" href="#promiserace">#</a>Promise.race()</h3><p>根据最快的一个决定状态。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> p </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">race</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">task1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> task2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> task2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="promiseresolve"></a><a aria-hidden="true" class="hash-link" href="#promiseresolve">#</a>Promise.resolve()</h3><p>Promise.resolve() 可以将一个对象转成 Promise 对象。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 等价于</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Promise.resolve() 的参数分为3种情况。</p><p>1、参数是 Promise 实例。会原封不动返回。
2、 thenable 对象，也就是具有 then 方法的对象。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> thenable </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> p1 </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">thenable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 1</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Promise.resolve() 会将它转成 Promise 对象，并立即执行 then 方法。</p><p>3、一般参数或不带参数</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> p </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// &#x27;hello&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="promisereject"></a><a aria-hidden="true" class="hash-link" href="#promisereject">#</a>Promise.reject()</h3><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 报错了</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>所以需要 catch 捕获。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> p </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>如果传入一个 thenable，后续 then 方法的参数是这个 thenable 对象。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-javascript codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">const</span><span class="token plain"> thenable </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;出错了&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">reject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">thenable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">e </span><span class="token operator" style="color:rgb(127, 219, 202)">===</span><span class="token plain"> thenable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// true</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><blockquote><p>Promise 的特点是什么，分别有什么优缺点？什么是 Promise 链？Promise 构造函数执行和 then 函数执行有什么区别？</p></blockquote><h3><a aria-hidden="true" class="anchor" id="实现符合promisea规范的promise"></a><a aria-hidden="true" class="hash-link" href="#实现符合promisea规范的promise">#</a>实现符合PromiseA+规范的Promise</h3><h2><a aria-hidden="true" class="anchor" id="async--await"></a><a aria-hidden="true" class="hash-link" href="#async--await">#</a>async + await</h2><blockquote><p>面试题：async 及 await 的特点，它们的优点和缺点分别是什么？await 原理是什么？</p></blockquote><p><code>async</code>函数会返回一个<code>Promise</code>。如果返回值不是Promise，就使用<code>Promise.resolve()</code>包裹了一下。如果是Promise，就执行。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Promise {&lt;resolved&gt;: 1}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>async 和 await 可以说是异步终极解决方案，它相当于将代码改造成了同步代码。可以使用<code>try...catch</code>捕获异常。</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">b</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    a </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(127, 219, 202)">+</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">await</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">a</span><span class="token operator" style="color:rgb(127, 219, 202)">++</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token console class-name" style="color:rgb(255, 203, 139)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 结果</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 0</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 1 1</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 2 10</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面代码可以看出，async 函数是同步执行的，但是 await 是异步的。</p><ul><li>首先执行<code>b()</code>，输出<code>0</code>。</li><li>然后 b 函数保存了<code>a = 0</code>（await 内部通过 generator 实现，generator 会保留堆栈中的内容），遇到异步的<code>await 10</code>时，会先去执行后面的同步代码<code>a++</code>，输出<code>1 1</code>。</li><li>最后再执行<code>await</code>，输出<code>2, 10</code>。</li></ul><p>await 内部实现了 generator，它是 generator 和 Promise 的语法糖，内部会自动执行 generator。</p><h2><a aria-hidden="true" class="anchor" id="定时器"></a><a aria-hidden="true" class="hash-link" href="#定时器">#</a>定时器</h2><h3><a aria-hidden="true" class="anchor" id="settimeout"></a><a aria-hidden="true" class="hash-link" href="#settimeout">#</a>setTimeout</h3><p>setTimeout 要注意的几点：</p><ol><li>因为 javascript 是单线程的，所以 setTimeout 的时间并不准确，具体可以看浏览器事件环。</li><li><code>setTimeout()</code>的返回值表示定时器的编号，可以传递给<code>clearTimeout()</code>取消定时器，浏览器中返回一个数字，NodeJs 中返回一个 Timeout 对象。<code>setTimeout()</code>和<code>setInterval()</code>公用一个编号池。</li></ol><h3><a aria-hidden="true" class="anchor" id="setinterval"></a><a aria-hidden="true" class="hash-link" href="#setinterval">#</a>setInterval</h3><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">let</span><span class="token plain"> intervalID </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setInterval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> param1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> param2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(127, 219, 202)">...</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" class="anchor" id="循环间隔-60hz"></a><a aria-hidden="true" class="hash-link" href="#循环间隔-60hz">#</a>循环间隔 60Hz</h3><p>动画循环的关键是循环间隔的时常。循环间隔要足够长，以保证浏览器有能力渲染产生的变化。另外循环间隔要足够短，以保证动画的流畅性。显示器刷新频率为 60Hz，即相当于每秒屏幕会重绘 60 次，即循环间隔最好是 16.7ms(1000ms/60)。</p><h3><a aria-hidden="true" class="anchor" id="requestanimationframe"></a><a aria-hidden="true" class="hash-link" href="#requestanimationframe">#</a>requestAnimationFrame</h3><p>requestAnimationFrame 是专门为实现高性能的帧动画而设计的一个 API。requestAnimationFrame 跟屏幕刷新频率同步(大多数是 60Hz)。这里的关键区别在于可以让浏览器在下一个可用时机去绘制动画，而不是以预定间隔绘制动画。</p><p>可以使用<code>cancelAnimationFrame(timer)</code>取消任务。</p><p>为了保证兼容，可以使用下面的代码：</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 判断是否有 requestAnimationFrame 方法，如果有则模拟实现</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">requestAnimFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">requestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">webkitRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">mozRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">oRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">msRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">30</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>上面的代码，如果不兼容，则使用 setTimeout 模拟。</p><p>它的优点是：</p><ol><li>浏览器可以对其进行优化，所以动画更流畅 </li><li>非活动选项卡中的动画会停止</li><li>更省电</li></ol><h3><a aria-hidden="true" class="anchor" id="使用-requestanimatinframe-实现动画"></a><a aria-hidden="true" class="hash-link" href="#使用-requestanimatinframe-实现动画">#</a>使用 requestAnimatinFrame 实现动画</h3><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-js codeBlock_2GNs" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">html</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">head</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">meta charset</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;UTF-8&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">title</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain">认识Canvas</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">title</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">head</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">body</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">canvas id</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;canvas&quot;</span><span class="token plain"> width</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;500&quot;</span><span class="token plain"> height</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;500&quot;</span><span class="token plain"> style</span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;border: 1px solid #333&quot;</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">canvas</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> canvas </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getElementById</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;canvas&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> context </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">getContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;2d&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 兼容定义 requestAnimFrame</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">requestAnimFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">requestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">webkitRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">mozRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">oRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">msRequestAnimationFrame</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">||</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setTimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1000</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">30</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 绘制的圆的对象</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> circle </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            radius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            direction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;right&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 移动圆形</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">move</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">direction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">===</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;right&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">430</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                         </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">direction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;left&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                         </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">-=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                        </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">direction</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;right&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">draw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 绘制圆形</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">beginPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 设置开始角度为0，结束角度为 2π 弧度</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">arc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">radius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">*</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(255, 203, 139)">Math</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token constant" style="color:rgb(130, 170, 255)">PI</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">fillStyle</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&#x27;#00c09b&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">fill</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 动画执行函数</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">animate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 随机更新圆形位置</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">move</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 清除画布</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">clearRect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">width</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">height</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 绘画圆</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">draw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 使用requestAnimationFrame实现动画循环</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">requestAnimationFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">animate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 先画第一帧的圆，即初始化的圆</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        circle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">draw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 执行animate</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">animate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">script</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">body</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token operator" style="color:rgb(127, 219, 202)">&lt;</span><span class="token operator" style="color:rgb(127, 219, 202)">/</span><span class="token plain">html</span><span class="token operator" style="color:rgb(127, 219, 202)">&gt;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="参考资料"></a><a aria-hidden="true" class="hash-link" href="#参考资料">#</a>参考资料</h2><ul><li><a href="https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/33">setTimeout、Promise、Async/Await 的区别</a></li><li><a href="https://juejin.im/post/5d2c814c6fb9a07ecd3d8e43">Async/Await 如何通过同步的方式实现异步</a></li><li><a href="http://es6.ruanyifeng.com/#docs/generator-async">Generator 函数的异步应用</a></li></ul></div></article><div class="margin-top--xl margin-bottom--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/f2e/javascript/module"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->javascript 模块化</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/f2e/javascript/regexp"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">正则表达式之理论与实战<!-- --> »</h4></a></div></nav><div id="gitalk-container"></div></div></div></div><div class="col col--3"><div class="tableOfContents_1X5y"><ul class="contents contents__left-border"><li><a href="#概念" class="contents__link">概念</a><ul class=""><li><a href="#并发和并行" class="contents__link">并发和并行</a></li></ul></li><li><a href="#异步发展" class="contents__link">异步发展</a></li><li><a href="#回调函数" class="contents__link">回调函数</a></li><li><a href="#生成器-generator" class="contents__link">生成器 Generator</a><ul class=""><li><a href="#简介" class="contents__link">简介</a></li><li><a href="#co库原理" class="contents__link">co库原理</a></li></ul></li><li><a href="#promise" class="contents__link">Promise</a><ul class=""><li><a href="#简介-1" class="contents__link">简介</a></li><li><a href="#promiseprototypethen" class="contents__link">Promise.prototype.then()</a></li><li><a href="#promiseprototypecatch" class="contents__link">Promise.prototype.catch()</a></li><li><a href="#promiseprototypefinally" class="contents__link">Promise.prototype.finally()</a></li><li><a href="#promiseall" class="contents__link">Promise.all()</a></li><li><a href="#promiserace" class="contents__link">Promise.race()</a></li><li><a href="#promiseresolve" class="contents__link">Promise.resolve()</a></li><li><a href="#promisereject" class="contents__link">Promise.reject()</a></li><li><a href="#实现符合promisea规范的promise" class="contents__link">实现符合PromiseA+规范的Promise</a></li></ul></li><li><a href="#async--await" class="contents__link">async + await</a></li><li><a href="#定时器" class="contents__link">定时器</a><ul class=""><li><a href="#settimeout" class="contents__link">setTimeout</a></li><li><a href="#setinterval" class="contents__link">setInterval</a></li><li><a href="#循环间隔-60hz" class="contents__link">循环间隔 60Hz</a></li><li><a href="#requestanimationframe" class="contents__link">requestAnimationFrame</a></li><li><a href="#使用-requestanimatinframe-实现动画" class="contents__link">使用 requestAnimatinFrame 实现动画</a></li></ul></li><li><a href="#参考资料" class="contents__link">参考资料</a></li></ul></div></div></div></div></div></main></div></div>
</div>

<script type="text/javascript" src="/runtime~main.354a7ac0b272a71e648f.js"></script>

<script type="text/javascript" src="/main.29b855f1437804751f1d.js"></script>

<script type="text/javascript" src="/0.3a7be5f9f27c0aab24a1.js"></script>

<script type="text/javascript" src="/1.929304febce56cf27a0a.js"></script>

<script type="text/javascript" src="/2.0e4922e2040d24209c11.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-page-9-e-7-ca5.083ae7dbb31619c2179f.js"></script>

<script type="text/javascript" src="/docsMetadata---docs-9-a-9-239.3af23731f0531e526af4.js"></script>

<script type="text/javascript" src="/3.c79e9d715ef2aa1f98a8.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-item-031-769.7e9f9ea227b79fde56c9.js"></script>

<script type="text/javascript" src="/content---docs-f-2-e-javascript-asynceb-2-d37.2d3aff55d5f2b86fc6f8.js"></script>

<script type="text/javascript" src="/metadata---docs-f-2-e-javascript-async-09-f-030.69ab038418723167bf52.js"></script>

</body>
</html>