<!DOCTYPE html>
<html lang=&#34;en&#34; data-theme=&#34;&#34;>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.cd8597ec8eb975fc8710.css","/main.cd8597ec8eb975fc8710.js"],"component---theme-blog-post-pageccc-cab":["/component---theme-blog-post-pageccc-cab.02a62d27203bdd98b318.js"],"content---blog-hola-6-d-8-57b":["/content---blog-hola-6-d-8-57b.cf51fd61e038d571daa7.js"],"metadata---blog-hola-918-90b":["/metadata---blog-hola-918-90b.11314fee1e552a82498a.js"],"component---users-banli-banli-blog-src-pages-index-jsfb-7-c6b":["/component---users-banli-banli-blog-src-pages-index-jsfb-7-c6b.22b4ea20a1b6b53bd232.css","/component---users-banli-banli-blog-src-pages-index-jsfb-7-c6b.22b4ea20a1b6b53bd232.js"],"metadata---8-ab-efb":["/metadata---8-ab-efb.7e11faf2402f7debbc9d.js"],"component---theme-blog-list-pagea-6-a-7ba":["/component---theme-blog-list-pagea-6-a-7ba.d20264b0076c39526595.js"],"content---blog-5-d-5-35e":["/content---blog-5-d-5-35e.a85c3560a085b246e405.js"],"metadata---blog-8-d-5-403":["/metadata---blog-8-d-5-403.f984c40c0918cc46c56a.js"],"component---theme-doc-legacy-page-9-e-7-ca5":["/component---theme-doc-legacy-page-9-e-7-ca5.0db2e06dd5012b1c4c60.css","/component---theme-doc-legacy-page-9-e-7-ca5.0db2e06dd5012b1c4c60.js"],"docsMetadata---docs-76-d-edd":["/docsMetadata---docs-76-d-edd.e0463ad5199d68e4671e.js"],"component---theme-doc-legacy-item-031-769":["/component---theme-doc-legacy-item-031-769.920d2fa2f36bcb7864cd.css","/component---theme-doc-legacy-item-031-769.920d2fa2f36bcb7864cd.js"],"content---docs-about-422-cb3":["/content---docs-about-422-cb3.2027da0cc198de2f48c6.js"],"metadata---docs-abouta-4-f-846":["/metadata---docs-abouta-4-f-846.9e815dc965c53eea316b.js"],"content---docs-doc-29-c-9-6d3":["/content---docs-doc-29-c-9-6d3.54f667ce08e297a0b857.js"],"metadata---docs-doc-2-bed-d62":["/metadata---docs-doc-2-bed-d62.6affa55b9cb128c64d20.js"],"content---docs-mdxf-7-b-309":["/content---docs-mdxf-7-b-309.b2ae36facbce2ef4e687.js"],"metadata---docs-mdxdf-2-f06":["/metadata---docs-mdxdf-2-f06.ed580022cd4ee8d530aa.js"],"content---docs-base-compute-combined-88-1f1":["/content---docs-base-compute-combined-88-1f1.6d8b762a095814634751.js"],"metadata---docs-base-compute-combined-1-b-754":["/metadata---docs-base-compute-combined-1-b-754.320549531dbbf5908f1b.js"],"content---docs-algo-indexf-58-41e":["/content---docs-algo-indexf-58-41e.1783f4831eb941cc18a1.js"],"metadata---docs-algo-index-3-da-9b7":["/metadata---docs-algo-index-3-da-9b7.7c5f2caa9419eab32308.js"],"content---docs-database-mongoc-49-83b":["/content---docs-database-mongoc-49-83b.da738657adf15fd42d56.js"],"metadata---docs-database-mongoe-54-98e":["/metadata---docs-database-mongoe-54-98e.77860a1c44943c98b303.js"],"content---docs-doc-3-da-9-dc5":["/content---docs-doc-3-da-9-dc5.8b8b50aa543a86ca86b7.js"],"metadata---docs-doc-312-d-57d":["/metadata---docs-doc-312-d-57d.c13aa553b9adffefef7d.js"],"content---docs-database-redis-861-47c":["/content---docs-database-redis-861-47c.7c106195cf75b7d210a7.js"],"metadata---docs-database-redisb-45-9ea":["/metadata---docs-database-redisb-45-9ea.aad502651eea5c26d8bc.js"],"content---docs-database-mysql-092-926":["/content---docs-database-mysql-092-926.a6553954a3ef3795c3bf.js"],"metadata---docs-database-mysqlc-31-563":["/metadata---docs-database-mysqlc-31-563.8964c1083f11237226c2.js"],"content---docs-html-doc-154-c-9b3":["/content---docs-html-doc-154-c-9b3.a94d3979c563c6a6b3dd.js"],"metadata---docs-html-doc-1-fcd-8ff":["/metadata---docs-html-doc-1-fcd-8ff.1b2ba8f3914cdd4f6752.js"],"content---docs-browser-workba-9-7be":["/content---docs-browser-workba-9-7be.99748832630c157cff04.js"],"metadata---docs-browser-work-3-d-9-7af":["/metadata---docs-browser-work-3-d-9-7af.632c6181c329291b15df.js"],"content---docs-javascript-oop-154-3a2":["/content---docs-javascript-oop-154-3a2.7e277f76981171875e7e.js"],"metadata---docs-javascript-oopc-52-edf":["/metadata---docs-javascript-oopc-52-edf.958d05e24b37cb32cbff.js"],"content---docs-javascript-asyncbae-08e":["/content---docs-javascript-asyncbae-08e.23a8990d2e9938a34963.js"],"metadata---docs-javascript-async-7-ab-b15":["/metadata---docs-javascript-async-7-ab-b15.435d7feb6bf1b193ee73.js"],"content---docs-javascript-type-723-131":["/content---docs-javascript-type-723-131.66967753f2fd9b40a0ff.js"],"metadata---docs-javascript-type-366-03e":["/metadata---docs-javascript-type-366-03e.2e4b536ee683af8a25fc.js"],"content---docs-linux-indexe-08-943":["/content---docs-linux-indexe-08-943.19df0d2b38a04fd44a8e.js"],"metadata---docs-linux-index-885-30a":["/metadata---docs-linux-index-885-30a.2e307a0d5a3a8e58c436.js"],"content---docs-nginx-index-711-8c5":["/content---docs-nginx-index-711-8c5.85b6b8b75a8706425ef6.js"],"metadata---docs-nginx-index-4-b-5-890":["/metadata---docs-nginx-index-4-b-5-890.5e0402c57e99e1d253e8.js"],"content---docs-other-mace-02-121":["/content---docs-other-mace-02-121.e6fda5679bdebde97965.js"],"metadata---docs-other-macc-2-b-c65":["/metadata---docs-other-macc-2-b-c65.874a3a87911d33ece2d4.js"],"content---docs-patterns-patterns-65-e-afa":["/content---docs-patterns-patterns-65-e-afa.219ec9c7c5965ef4bf1f.js"],"metadata---docs-patterns-patterns-5-be-c3b":["/metadata---docs-patterns-patterns-5-be-c3b.c6a06c8c0c2b6a6f7a8c.js"],"component---theme-blog-tags-posts-page-687-b6c":["/component---theme-blog-tags-posts-page-687-b6c.fc2daa1ed293db2abfd6.js"],"metadata---blog-tags-hola-90-f-bad":["/metadata---blog-tags-hola-90-f-bad.7ce1f129e8dfa0dc41b5.js"],"metadata---blog-tags-docusaurus-69-f-df1":["/metadata---blog-tags-docusaurus-69-f-df1.aacf3a93f7eaa81248af.js"],"component---theme-blog-tags-list-page-01-a-d0b":["/component---theme-blog-tags-list-page-01-a-d0b.6f444b877be506fa64e0.js"],"tags---blog-tags-3-c-9-4c8":["/tags---blog-tags-3-c-9-4c8.f80c0b440f1d51a1ef94.js"]};/*]]>*/</script>

<title data-react-helmet="true">Nginx基础知识</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Nginx基础知识"/><meta data-react-helmet="true" name="description" content="## 什么是Nginx"/><meta data-react-helmet="true" property="og:description" content="## 什么是Nginx"/><meta data-react-helmet="true" property="og:url" content="https://www.banli17.com/docs/nginx/index"/><meta data-react-helmet="true" name="twitter:card" content="summary"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.cd8597ec8eb975fc8710.css" />

<link rel="stylesheet" type="text/css" href="/1.6dd25177d3651995ab70.css" />

<link rel="stylesheet" type="text/css" href="/2.4033ddc9c38b6d4c2912.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-page-9-e-7-ca5.0db2e06dd5012b1c4c60.css" />

<link rel="stylesheet" type="text/css" href="/component---theme-doc-legacy-item-031-769.920d2fa2f36bcb7864cd.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"/><strong>banli17.com</strong></a><a class="navbar__item navbar__link" label="前端必备" position="left" href="/docs/html/doc1">前端必备</a><a class="navbar__item navbar__link" label="设计模式" position="left" href="/docs/patterns/patterns">设计模式</a><a class="navbar__item navbar__link" label="数据结构与算法" position="left" href="/docs/algo/index">数据结构与算法</a><a class="navbar__item navbar__link" label="数据库" position="left" href="/docs/database/mongo">数据库</a><a class="navbar__item navbar__link" label="服务器" position="left" href="/docs/linux/index">服务器</a><a class="navbar__item navbar__link" label="工具集" position="left" href="/docs/other/mac">工具集</a><a class="navbar__item navbar__link" label="博客" position="left" href="/blog">博客</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" label="关于" position="right" href="/docs/about">关于</a><a class="navbar__item navbar__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_1gtMWLzW"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vChPFo moon_1N64xB5S"></span></div><div class="react-toggle-track-x"><span class="toggle_16vChPFo sun_3CZP6R61"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"/><strong>banli17.com</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" label="前端必备" position="left" href="/docs/html/doc1">前端必备</a></li><li class="menu__list-item"><a class="menu__link" label="设计模式" position="left" href="/docs/patterns/patterns">设计模式</a></li><li class="menu__list-item"><a class="menu__link" label="数据结构与算法" position="left" href="/docs/algo/index">数据结构与算法</a></li><li class="menu__list-item"><a class="menu__link" label="数据库" position="left" href="/docs/database/mongo">数据库</a></li><li class="menu__list-item"><a class="menu__link" label="服务器" position="left" href="/docs/linux/index">服务器</a></li><li class="menu__list-item"><a class="menu__link" label="工具集" position="left" href="/docs/other/mac">工具集</a></li><li class="menu__list-item"><a class="menu__link" label="博客" position="left" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" label="关于" position="right" href="/docs/about">关于</a></li><li class="menu__list-item"><a class="menu__link" href="https://github.com/banli17" label="GitHub" position="right" target="_blank" rel="noopener noreferrer">GitHub</a></li></ul></div></div></div></nav><div class="container container--fluid"><div class="row"><div class="col col--3"><div class="sidebar_Qb2Sh3ns"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_1uhTlVQy" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">linux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/linux/index">学习linux操作系统</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">nginx</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/nginx/index">Nginx基础知识</a></li></ul></li></ul></div></div></div><main class="col"><div><div class="padding-vert--lg"><div class="row"><div class="col"><div class="docItemContainer_3Gwslgp0"><header><h1 class="margin-bottom--lg">Nginx基础知识</h1></header><article><div class="markdown"><h2><a aria-hidden="true" class="anchor" id="什么是nginx"></a><a aria-hidden="true" class="hash-link" href="#什么是nginx">#</a>什么是Nginx</h2><p>中间件的作用是隔离应用与应用，应用与操作系统，层次分明，让应用专注于业务。而 Nginx 就是一个开源且高性能、可靠的HTTP中间件、代理服务。</p><h2><a aria-hidden="true" class="anchor" id="常见的中间件服务"></a><a aria-hidden="true" class="hash-link" href="#常见的中间件服务">#</a>常见的中间件服务</h2><ul><li>HTTPD: apache基金会的产品</li><li>IIS: 微软</li><li>GWS: google web server</li></ul><h2><a aria-hidden="true" class="anchor" id="为什么选择nginx"></a><a aria-hidden="true" class="hash-link" href="#为什么选择nginx">#</a>为什么选择nginx?</h2><p><strong>1、IO多路复用epoll(单线程异步IO)</strong></p><p>为了解决并发的问题，可以采用的方案有多线程、IO多路复用。多线程存在资源消耗的问题。IO多路复用就是单线程异步IO，响应会主动上报(内核会主动发送文件信息给应用端)。</p><p>IO多路复用的实现方式：select、poll、epoll。</p><ul><li><code>select</code>: 是单线程同步的方式，效率低下，而且能够监听文件描述符的数量存在最大限制1024个。</li><li><code>epoll</code>: 是单线程异步的方式，最大连接无限制。</li></ul><p><strong>2、轻量级</strong></p><ul><li>功能模块少，只保留了和http核心相关的代码。</li><li>代码模块化</li></ul><p><strong>3、CPU亲和</strong></p><p>多核服务器主要用于多线程，密集计算型服务使用。如果有多个CPU，利用它自动的切换工作方式，会造成性能的损耗。</p><p>Nginx是将工作进程和CPU核心，也就是把每个 worker 进程固定到一个 CPU 上执行，减少切换 CPU 的 cache miss，获得更好的性能。</p><p><img src="./1/nginx.png"/></p><p><strong>4、sendfile</strong></p><p>nginx处理静态资源服务是非常高效的。</p><p>请求文件时，会经过操作系统的<code>内核空间 -&gt; 用户空间 -&gt; 内核空间 -&gt; Socket</code>多次切换后返回给用户。但是静态文件的获取时可以在内核空间直接返回，不需要用户空间的逻辑处理。nginx是采用了linux2的零拷贝传输模式，把文件的传输只通过内核空间传给Socket，返回给用户。所以在CBN、或动静分离的静态文件处理上，性能更优。</p><p><img src="./1/2.png"/></p><h2><a aria-hidden="true" class="anchor" id="安装"></a><a aria-hidden="true" class="hash-link" href="#安装">#</a>安装</h2><p>官网网站：<a href="http://nginx.org/en/download.html">http://nginx.org/</a>。版本信息如下：</p><ul><li><code>Mainline version</code>: 开发版本</li><li><code>Stable version</code>: 稳定版本</li><li><code>Legacy version</code>: 历史版本</li><li><code>CHANGES</code>: 版本更新信息</li><li><code>pgp</code>: 用于对源代码做安全校验的工具，非官方下载的包要验证一下。</li><li><code>source code</code>: 源代码提交、修改记录</li><li><code>Pre-Built Packages</code>: 通过 yum 等方式源安装，里面有各个系统,如 centeros 的安装方式</li></ul><p><strong>centeros安装方式</strong></p><ol><li>新建<code>vim /etc/yum.repos.d/nginx.repo</code>，这个是 nginx 的源(我的腾讯云不需要这步，直接yum install nginx即可，加了这个文件反而有错误，应该是要翻墙的问题)。</li></ol><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-undefined codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># centos是系统,7是系统版本</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">[nginx]</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">name=nginx repo</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">baseurl=http://nginx.org/packages/centos/OSRELEASE/7/$basearch/</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">gpgcheck=0</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">enabled=1</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><ul><li><code>yum list |grep nginx</code>: 列出 nginx 的版本</li><li><code>yum install nginx</code>：安装</li></ul><ol start="2"><li><p>执行安装命令：<code>yum install nginx</code>。</p></li><li><p>检查安装成功，通过命令<code>nginx -v</code>。</p></li></ol><ul><li><code>nginx -V</code>：编译的参数。</li></ul><h2><a aria-hidden="true" class="anchor" id="安装目录"></a><a aria-hidden="true" class="hash-link" href="#安装目录">#</a>安装目录</h2><p>通过yum安装都是一个个的rpm包。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-undefined codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># 列出安装时创建的文件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">rpm -ql nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 配置文件，Nginx日志轮转，用于logrotate服务的日志切割</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/logrotate.d/nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 目录和配置文件，作用是nginx主配置文件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/nginx.conf    // 启动加载的配置文件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/conf.d</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/conf.d/default.conf // 默认读的配置文件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># cgi配置相关，fastcgi配置</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/fastcgi_params</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/uwsgi_params</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/scgi_params</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 编码转换映射转化文件，很少用到</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/koi-utf</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/koi-win</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/win-utf</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 设置http协议的Content-Type与扩展名对应关系，不能识别的扩展名可以在这里添加</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/etc/nginx/mime.types</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 用于配置出系统守护进程管理器管理方式，centeros7.2新的方式</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/lib/systemd/system/nginx-debug.service</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/lib/systemd/system/nginx.service</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/sysconfig/nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/sysconfig/nginx-debug</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># Nginx模块目录，安装的一些模块</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/lib64/nginx/modules</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/nginx/modules</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># nginx服务的启动管理的终端命令</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/sbin/nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/sbin/nginx-debug    // 用来具体的调试分析</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 手册和帮助文件</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/share/doc/nginx-1.12.0</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/share/doc/nginx-1.12.0/COPYRIGHT</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/usr/share/man/man8/nginx.8.gz</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># nginx的缓存目录</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/var/cache/nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># nginx的日志目录</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">/var/log/nginx</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><h2><a aria-hidden="true" class="anchor" id="安装编译参数"></a><a aria-hidden="true" class="hash-link" href="#安装编译参数">#</a>安装编译参数</h2><p>通过<code>nginx -V</code>命令查看。就是通过源码编译(<code>./configure</code>)时带的参数。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-undefined codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># 安装目录</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--prefix=/usr/share/nginx </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--sbin-path=/usr/sbin/nginx </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--modules-path=/usr/lib64/nginx/modules </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--conf-path=/etc/nginx/nginx.conf </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--error-log-path=/var/log/nginx/error.log </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 执行对应模块时，nginx所保留的临时性文件，不是很重要的</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-log-path=/var/log/nginx/access.log </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-client-body-temp-path=/var/lib/nginx/tmp/client_body</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-proxy-temp-path=/var/lib/nginx/tmp/proxy </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--http-scgi-temp-path=/var/lib/nginx/tmp/scgi </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 设定nginx进程启动的用户和组用户，虽然是用root运行，但是它是用nginx用户在跑</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--user=nginx --group=nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 设置额外的参数将被添加到CFLAGS参数</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic&#x27;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 设置附加的参数，链接系统库。比如c编译要依赖那些库，可以把路径添加进来，找库</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">--with-ld-opt=&#x27;-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><ul><li><code>ps -ef | grep nginx</code></li><li><code>find /|grep nginx.conf</code>: 查找安装目录</li></ul><h2><a aria-hidden="true" class="anchor" id="nginx基础语法"></a><a aria-hidden="true" class="hash-link" href="#nginx基础语法">#</a>nginx基础语法</h2><p><strong>主配置文件 /etc/nginx/nginx.conf</strong></p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-undefined codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">user 设置nginx服务的系统使用用户，和上面的--user类似 </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">worker_processes 工作进程数，设置为cpu数即可</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">error_log 错误日志</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">pid 服务启动时候的pid，会把启动的信息写入文件中</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">events </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    - worker_connections 每个进程允许的最大连接数</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    - use  定义内核模型,select或epoll</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">http {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    ...</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    # 每个独立站点</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    server {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        listen 80;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        server_name localhost; # 域名</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        # 配置默认访问的路径</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        location / {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            # 存放首页的目录</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            root  /usr/share/nginx/html;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            # 首页的路径</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            index index.html index.htm;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        # 错误页面，把500,502,503,504错误码页面定位到50x.html</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        error_page 500 502 503 504 /50x.html</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        location = /50x.html {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            # 页面存放在系统的哪个目录下面</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            root  /usr/share/nginx/html; </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    server {}</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><ul><li>log_format 日志类型</li></ul><h2><a aria-hidden="true" class="anchor" id="nginx-403-forbidden错误"></a><a aria-hidden="true" class="hash-link" href="#nginx-403-forbidden错误">#</a>nginx 403 forbidden错误</h2><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-undefined codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># 查看nginx状态，绿色active表示正常</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">systemctl status nginx </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 查看端口</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">netstat -tnlp </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># nginx端口被占用了</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">ps -ef | grep nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">pkill -9 nginx</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 重载服务</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 无效 service nginx start</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"># 有效 service sshd reload </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">nginx -s reload</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>参考资料：<a href="https://blog.csdn.net/u012832088/article/details/80729002">关于Nginx不能正常启动的问题</a></p><p>404，先ping一下看看ip，可能hosts文件改了。</p><h2><a aria-hidden="true" class="anchor" id="配置https"></a><a aria-hidden="true" class="hash-link" href="#配置https">#</a>配置https</h2><p>首先在腾讯云申请https证书，然后下载。下载完成后通过下面命令上传到服务器。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-bash codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># 将文件上传到服务器的data目录</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">scp</span><span class="token plain"> www.banli17.com_bundle.crt  www.banli17.com.key  root@101.101.111.121:data/key/</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>然后设置<code>/etc/nginx/nginx.conf</code>文件。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-nginx codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain">server {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        listen 80;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        server_name  banli17.com www.banli17.com;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        rewrite ^(.*)$ https://$host$1 permanent;   # 重定向http 到 https</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    server {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        listen 443;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        server_name  banli17.com www.banli17.com;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        #root         /usr/share/nginx/html;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        # 设置 https 证书</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl on;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_certificate /data/key/www.banli17.com_bundle.crt;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_certificate_key /data/key/www.banli17.com.key;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_session_timeout 5m;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        ssl_prefer_server_ciphers on;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        # Load configuration files for the default server block.</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        include /etc/nginx/default.d/*.conf;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        location / {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                root  /data/www/blog/public;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                index index.html;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        error_page 404 /404.html;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            location = /40x.html {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        error_page 500 502 503 504 /50x.html;</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            location = /50x.html {</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        }</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    }</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>最后通过<code>service nginx reload</code>重载一下后，就可以了。在浏览器输入<code>http://www.banli17.com</code>就可以重定向到<code>https://www.banli17.com</code>了。</p></div></article><div class="margin-top--xl margin-bottom--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/linux/index"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« <!-- -->学习linux操作系统</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2wxO1YRc"><ul class="contents contents__left-border"><li><a href="#什么是nginx" class="contents__link">什么是Nginx</a></li><li><a href="#常见的中间件服务" class="contents__link">常见的中间件服务</a></li><li><a href="#为什么选择nginx" class="contents__link">为什么选择nginx?</a></li><li><a href="#安装" class="contents__link">安装</a></li><li><a href="#安装目录" class="contents__link">安装目录</a></li><li><a href="#安装编译参数" class="contents__link">安装编译参数</a></li><li><a href="#nginx基础语法" class="contents__link">nginx基础语法</a></li><li><a href="#nginx-403-forbidden错误" class="contents__link">nginx 403 forbidden错误</a></li><li><a href="#配置https" class="contents__link">配置https</a></li></ul></div></div></div></div></div></main></div></div>
</div>

<script type="text/javascript" src="/runtime~main.8e4584f979e619f4e751.js"></script>

<script type="text/javascript" src="/main.cd8597ec8eb975fc8710.js"></script>

<script type="text/javascript" src="/0.204e5db3f5dd12dd0588.js"></script>

<script type="text/javascript" src="/1.6dd25177d3651995ab70.js"></script>

<script type="text/javascript" src="/2.4033ddc9c38b6d4c2912.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-page-9-e-7-ca5.0db2e06dd5012b1c4c60.js"></script>

<script type="text/javascript" src="/docsMetadata---docs-76-d-edd.e0463ad5199d68e4671e.js"></script>

<script type="text/javascript" src="/component---theme-doc-legacy-item-031-769.920d2fa2f36bcb7864cd.js"></script>

<script type="text/javascript" src="/content---docs-nginx-index-711-8c5.85b6b8b75a8706425ef6.js"></script>

<script type="text/javascript" src="/metadata---docs-nginx-index-4-b-5-890.5e0402c57e99e1d253e8.js"></script>

</body>
</html>