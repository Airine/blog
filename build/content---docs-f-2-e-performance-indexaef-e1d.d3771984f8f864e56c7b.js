(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{176:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",function(){return b}),n.d(t,"rightToc",function(){return c}),n.d(t,"default",function(){return p});n(0);var l=n(251);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e}).apply(this,arguments)}function a(e,t){if(null==e)return{};var n,l,r=function(e,t){if(null==e)return{};var n,l,r={},a=Object.keys(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)n=a[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b={title:"网站性能优化"},c=[{value:"性能体系的建立",id:"性能体系的建立",children:[]},{value:"性能衡量指标",id:"性能衡量指标",children:[]},{value:"优化手段",id:"优化手段",children:[]}],i={rightToc:c},u="wrapper";function p(e){var t=e.components,n=a(e,["components"]);return Object(l.b)(u,r({},i,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"网站的性能会直接影响到用户体验，而用户体验会影响网站的收益。因此网站的性能优化十分重要。"),Object(l.b)("h2",{id:"性能体系的建立"},"性能体系的建立"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"现状评估和建立指标"),Object(l.b)("li",{parentName:"ul"},"技术方案"),Object(l.b)("li",{parentName:"ul"},"执行"),Object(l.b)("li",{parentName:"ul"},"结果评估和监控")),Object(l.b)("p",null,"指标要考虑用户体验，公司业务。"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"页面加载性能，和用户流失率强相关，正是公司业务非常看中的",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"页面加载时间",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"1s内，用户感知区别不大"),Object(l.b)("li",{parentName:"ul"},"少数超长时间加载的用户，不考虑"))))),Object(l.b)("li",{parentName:"ul"},"动画和操作性能"),Object(l.b)("li",{parentName:"ul"},"内存、电量消耗")),Object(l.b)("p",null,"从域名到 IP 地址，需要用 DNS 协议查询；\nHTTP 协议是用 TCP 传输的，所以会有 TCP 建立连接过程；\n如果使用 HTTPS，还有有 HTTPS 交换证书；\n每个网页还有图片等请求。"),Object(l.b)("p",null,"网页的加载时间，和体积、请求数有关。"),Object(l.b)("p",null,"最终技术方案："),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"缓存: 客户端控制的强缓存策略"),Object(l.b)("li",{parentName:"ul"},"降低请求成本  ",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"HTTP DNS :客户端控制，隔一段时间主动请求 DNS 获取域名ip，不走系统DNS"),Object(l.b)("li",{parentName:"ul"},"TCP/TLS 连接复用：由服务器升级到 HTTP2，尽量合并域名"))),Object(l.b)("li",{parentName:"ul"},"减少请求数",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"js,css打包到html"),Object(l.b)("li",{parentName:"ul"},"js 控制图片异步加载和懒加载"),Object(l.b)("li",{parentName:"ul"},"小图片 data-uri"))),Object(l.b)("li",{parentName:"ul"},"减少传输体积",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"svg/gradient 代替图片"),Object(l.b)("li",{parentName:"ul"},"根据机型和网络控制图片清晰度"),Object(l.b)("li",{parentName:"ul"},"低清晰度图片使用锐化提升体验"),Object(l.b)("li",{parentName:"ul"},"避免设计大型背景图")))),Object(l.b)("p",null,"要做好性能优化，必须整个业务一起考虑，才能有良好的收获。"),Object(l.b)("p",null,"执行"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"纯管理"),Object(l.b)("li",{parentName:"ul"},"制度化"),Object(l.b)("li",{parentName:"ul"},"工程化")),Object(l.b)("p",null,"结果评估和线上监控"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"数据采集 Performance API"),Object(l.b)("li",{parentName:"ul"},"数据展现 ")),Object(l.b)("h2",{id:"性能衡量指标"},"性能衡量指标"),Object(l.b)("p",null,"打开一个页面时"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"开始请求  performance.timing.navigationStart"),Object(l.b)("li",{parentName:"ul"},"获取首字节  performance.timing.responseStart"),Object(l.b)("li",{parentName:"ul"},"页面开始展示 用户屏幕开始展示内容的时刻，白屏时间"),Object(l.b)("li",{parentName:"ul"},"首屏内容加载完成  首屏时间"),Object(l.b)("li",{parentName:"ul"},"加载完成")),Object(l.b)("p",null,"中间三个主要的性能衡量指标"),Object(l.b)("p",null,"白屏时间: 开始渲染 body 的时间，可以在 head 的头部和尾部插入 startTime endTime，"),Object(l.b)("pre",null,Object(l.b)("code",r({parentName:"pre"},{}),"// 支持performance\nvar time = endTime - performance.timing.navigationStart\n// 不支持performance\nvar time = endTime - startTime\n")),Object(l.b)("p",null,"首屏时间：above the fold 首屏线上的区域"),Object(l.b)("p",null,"在首屏线 代码处插入时间 Date.now() 兼容 performance 和 不兼容(用 head尾部作为startTime)"),Object(l.b)("p",null,"分析页面 network"),Object(l.b)("h2",{id:"优化手段"},"优化手段"),Object(l.b)("p",null,"浏览器请求服务器资源，就是送货一样。可以减少运输次数(一次多运输点)，减少货物体积，增加货车速度。"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"减少请求文件数"),Object(l.b)("li",{parentName:"ul"},"减少资源体积： 精简体积、压缩文件、gzip (accept-encoding:gzip  content-encoding:gzip)"),Object(l.b)("li",{parentName:"ul"},"提高网络传输:浏览器缓存(减少数据传输，减少服务器压力) ")),Object(l.b)("p",null,"cdn(内容分发网络) :多域名并发 、网络线路"),Object(l.b)("p",null,"DNS解析和寻址\n服务器建立连接\n发送数据\n等待服务器响应\n接收数据"),Object(l.b)("p",null,"请求变多 -> 页面加载变慢，服务器压力变大"),Object(l.b)("p",null,"CDN(内容分发网络) 是将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。\n合并请求 的主要目的是减少浏览器对服务器发起的请求数，从而减少在发起请求过程中花费的时间。\nGzip 是一种压缩技术，可以将资源在服务端进行压缩，然后发送给浏览器后再进行解压，这种方式会降低传输大小，提高网页加载性能。\n通过工具移除代码中不必要的字符 如所有的注释和空白字符，可以减少代码资源文件体积，提高资源加载速度。"))}p.isMDXComponent=!0},251:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return o});var l=n(0),r=n.n(l),a=r.a.createContext({}),b=function(e){var t=r.a.useContext(a),n=t;return e&&(n="function"==typeof e?e(t):Object.assign({},t,e)),n},c=function(e){var t=b(e.components);return r.a.createElement(a.Provider,{value:t},e.children)};var i="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=function(e){var t=e.components,n=e.mdxType,l=e.originalType,a=e.parentName,c=function(e,t){var n={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&-1===t.indexOf(l)&&(n[l]=e[l]);return n}(e,["components","mdxType","originalType","parentName"]),i=b(t),p=n,o=i[a+"."+p]||i[p]||u[p]||l;return t?r.a.createElement(o,Object.assign({},c,{components:t})):r.a.createElement(o,c)};function o(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,b=new Array(a);b[0]=p;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c[i]="string"==typeof e?e:l,b[1]=c;for(var o=2;o<a;o++)b[o]=n[o];return r.a.createElement.apply(null,b)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);