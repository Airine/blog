(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{257:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",function(){return c}),t.d(n,"rightToc",function(){return o}),t.d(n,"default",function(){return s});t(0);var a=t(301);function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c={title:"react-native 一键分享多图到微信",date:new Date("2016-10-13T01:51:25.000Z"),toc:!0},o=[{value:"一键分享多图到微信",id:"一键分享多图到微信",children:[]},{value:"安卓版本",id:"安卓版本",children:[]}],l={rightToc:o},p="wrapper";function s(e){var n=e.components,t=i(e,["components"]);return Object(a.b)(p,r({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"一键分享多图到微信"},"一键分享多图到微信"),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},"今天在github上找到个插件",Object(a.b)("a",{href:"https://github.com/kmlidc/react-native-share-local",target:"_blank"},"react-native-share-local"),"，可以直接用 ")),Object(a.b)("p",null,"公司app有一个需求，实现多图文分享，但是微信官方提供的api没有提供接口，所以只能用原生的分享实现。"),Object(a.b)("h2",{id:"安卓版本"},"安卓版本"),Object(a.b)("p",null,"1、首先用",Object(a.b)("inlineCode",{parentName:"p"},"android studio"),"打开",Object(a.b)("inlineCode",{parentName:"p"},"react-native")," 的",Object(a.b)("inlineCode",{parentName:"p"},"android"),"项目新建一个",Object(a.b)("inlineCode",{parentName:"p"},"library"),"，名字叫做：",Object(a.b)("inlineCode",{parentName:"p"},"umshare"),"。"),Object(a.b)("p",null,"2、引入",Object(a.b)("inlineCode",{parentName:"p"},"umshare"),"包，即在项目的",Object(a.b)("inlineCode",{parentName:"p"},"android/setting.gradle"),"中添加一个",Object(a.b)("inlineCode",{parentName:"p"},":umshare")),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),"include ':react-native-code-push', ':umshare' //(只要这个)\nproject(':react-native-code-push').projectDir = new File(rootProject.projectDir, '../node_modules/react-native-code-push/android/app')\n")),Object(a.b)("p",null,"3、在",Object(a.b)("inlineCode",{parentName:"p"},"umshare"),"目录下的",Object(a.b)("inlineCode",{parentName:"p"},"src/main/java/com/ddck/umshare"),"目录里，添加三个文件",Object(a.b)("inlineCode",{parentName:"p"},"UShare.java"),"、",Object(a.b)("inlineCode",{parentName:"p"},"UShareModule.java"),"、",Object(a.b)("inlineCode",{parentName:"p"},"UShareReactPackage.java"),"。"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"UShare.java"),"的内容如下："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),'package com.ddck.umshare;\n\nimport android.app.Activity;\nimport android.content.ComponentName;\n\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.ContentResolver;\nimport android.provider.MediaStore;\nimport android.database.Cursor;\n\nimport android.net.Uri;\nimport java.io.File;\n\nimport android.widget.Toast;\nimport com.facebook.react.bridge.*;\nimport java.util.*;\nimport java.lang.ref.WeakReference;\n\npublic class UShare {\n    private static WeakReference<Activity> mActivity;\n\n    public static void init(Activity activity) {\n        if (activity == null) return;\n        mActivity = new WeakReference<>(activity);\n    }\n\n    public static String getRealFilePath(final Context context, final Uri uri) {\n        if (null == uri) return null;\n        final String scheme = uri.getScheme();\n        String data = null;\n        if (scheme == null)\n            data = uri.getPath();\n        else if (ContentResolver.SCHEME_FILE.equals(scheme)) {\n            data = uri.getPath();\n        } else if (ContentResolver.SCHEME_CONTENT.equals(scheme)) {\n            Cursor cursor = context.getContentResolver().query(uri, new String[]{MediaStore.Images.ImageColumns.DATA}, null, null, null);\n            if (null != cursor) {\n                if (cursor.moveToFirst()) {\n                    int index = cursor.getColumnIndex(MediaStore.Images.ImageColumns.DATA);\n                    if (index > -1) {\n                        data = cursor.getString(index);\n                    }\n                }\n                cursor.close();\n            }\n        }\n        return data;\n    }\n\n    /**\n     * 通过url 得到文件路径\n     *\n     * @param url\n     * @return\n     */\n    public static String getRealFilePath(String url) {\n        return getRealFilePath(mActivity.get(), Uri.parse(url));\n    }\n\n    public static void share(String Kdescription, ReadableArray paths){\n            if (mActivity == null) return;\n            Intent intent = new Intent();\n            intent.setComponent(new ComponentName("com.tencent.mm", "com.tencent.mm.ui.tools.ShareToTimeLineUI"));\n            intent.setAction("android.intent.action.SEND_MULTIPLE");\n            ArrayList<Uri> imageList = new ArrayList<Uri>();\n            for(int i=0; i<paths.size();i++){\n                String picPath = paths.getString(i);\n                File f = new File(getRealFilePath(picPath));\n\n                if (f.exists()) {\n                    imageList.add(Uri.fromFile(f));\n                }\n            }\n\n            if(imageList.size() == 0){\n                return;\n            }\n            intent.setType("image/*");\n            intent.putExtra(Intent.EXTRA_STREAM, imageList); //图片数据（支持本地图片的Uri形式）\n            intent.putExtra("Kdescription", Kdescription); //微信分享页面，图片上边的描述\n            mActivity.get().startActivity(intent);\n\n        }\n\n}\n')),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"UShareModule.java"),"的内容如下："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),'package com.ddck.umshare;\n\n/**\n * Created by banli on 16/6/26.\n */\n\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.bridge.ReactContextBaseJavaModule;\nimport com.facebook.react.bridge.ReactMethod;\nimport com.facebook.react.bridge.ReadableArray;\n/**\n * 分享组件\n */\n\npublic class UShareModule extends ReactContextBaseJavaModule{\n\n    public UShareModule(ReactApplicationContext reactContext) {\n        super(reactContext);\n    }\n\n    @Override\n    public String getName() {\n        return "UShare";\n    }\n\n    @ReactMethod\n    public static void share(String Kdescription, ReadableArray paths){\n        UShare.share( Kdescription, paths);\n    }\n}\n')),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"UShareReactPackage.java"),"的内容如下："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),"package com.ddck.umshare;\n\n/**\n * Created by banli on 16/6/26.\n */\n\n\nimport com.facebook.react.ReactPackage;\nimport com.facebook.react.bridge.JavaScriptModule;\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.uimanager.ViewManager;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\n\npublic class UShareReactPackage implements ReactPackage {\n\n    @Override\n    public List<Class<? extends JavaScriptModule>> createJSModules() {\n        return Collections.emptyList();\n    }\n\n    @Override\n    public List<ViewManager> createViewManagers(ReactApplicationContext reactContext) {\n        return Collections.emptyList();\n    }\n\n    @Override\n    public List<NativeModule> createNativeModules(\n            ReactApplicationContext reactContext) {\n        List<NativeModule> modules = new ArrayList<>();\n        modules.add(new UShareModule(reactContext));\n        return modules;\n    }\n}\n")),Object(a.b)("p",null,"4、在",Object(a.b)("inlineCode",{parentName:"p"},"android/app/src/main/AndroidMainfest.xml"),"里添加下面的代码："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),'<activity\n      android:name=".wxapi.WXEntryActivity"\n      android:label="@string/app_name"\n      android:exported="true"\n/>\n\n')),Object(a.b)("p",null,"5、在",Object(a.b)("inlineCode",{parentName:"p"},"android/app/src/main/com/包名/MainApplication.java"),"中添加如下代码："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-Java"}),"import com.ddck.umshare.UShareReactPackage;  // 添加\n\nprotected List<ReactPackage> getPackages() {\n      return Arrays.<ReactPackage>asList(\n          new MainReactPackage(),\n          new UShareReactPackage()  // 添加\n      );\n}\n")),Object(a.b)("p",null,"6、在",Object(a.b)("inlineCode",{parentName:"p"},"android/app/src/main/com/包名/MainActivity.java"),"中添加如下代码："),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-javascript"}),"import com.ddck.umshare.UShare;  // 添加\n\nprotected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        UShare.init(this);   // 添加\n}\n")),Object(a.b)("p",null,"7、导出给js使用，在项目中添加一个",Object(a.b)("inlineCode",{parentName:"p"},"UShare.js"),"即可"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-javascript"}),"import { NativeModules } from 'react-native';\nmodule.exports = NativeModules.UShare;\n")),Object(a.b)("p",null,"8、使用"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-javascript"}),"// 需要首先将图片缓存到本地、然后放到相册中，获取相册中的地址\nimport UShare from 'basic/UShare'\nlet path = ImageCache.get().cache[IMG_BASE + imgs[i]].path; \nif (!path) {\n    throw new Error(\"图片还没有加载完成\")\n    return\n}\nawait CameraRoll.saveToCameraRoll(path, 'photo').then((e)=> {\n    this.shareImgs[i] = e\n})\nUShare.share(this.shareImgs, ()=> {})\n")),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"参考资料")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",r({parentName:"li"},{href:"http://blog.csdn.net/u014220518/article/details/53465631"}),"http://blog.csdn.net/u014220518/article/details/53465631")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{href:"https://github.com/JeffWangGithub/TestWXMultiShare",target:"_blank"},"微信多图文分享安卓TestWXMultiShare")," "),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",{href:"http://www.jianshu.com/p/ce123a2015f9",target:"_blank"},"ios多图程序内分享到微信"))))}s.isMDXComponent=!0},301:function(e,n,t){"use strict";t.d(n,"a",function(){return o}),t.d(n,"b",function(){return u});var a=t(0),r=t.n(a),i=r.a.createContext({}),c=function(e){var n=r.a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):Object.assign({},n,e)),t},o=function(e){var n=c(e.components);return r.a.createElement(i.Provider,{value:n},e.children)};var l="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},s=function(e){var n=e.components,t=e.mdxType,a=e.originalType,i=e.parentName,o=function(e,n){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===n.indexOf(a)&&(t[a]=e[a]);return t}(e,["components","mdxType","originalType","parentName"]),l=c(n),s=t,u=l[i+"."+s]||l[s]||p[s]||a;return n?r.a.createElement(u,Object.assign({},o,{components:n})):r.a.createElement(u,o)};function u(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,c=new Array(i);c[0]=s;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[l]="string"==typeof e?e:a,c[1]=o;for(var u=2;u<i;u++)c[u]=t[u];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}s.displayName="MDXCreateElement"}}]);